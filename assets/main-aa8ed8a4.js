import{u as H,r as w,j as t,R as q,m as k,a as z,s as S,B,b as V,c as F,d as Q}from"./vendor-4271a838.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const c of e)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(e){const c={};return e.integrity&&(c.integrity=e.integrity),e.referrerPolicy&&(c.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?c.credentials="include":e.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(e){if(e.ep)return;e.ep=!0;const c=r(e);fetch(e.href,c)}})();function T(s){if(!s)return null;const n=U(s);if(n===-1)return null;const r=s.substring(n),o=D(r);return o?R(o):null}function U(s){const n=[{pattern:/<h[3-4][^>]*>[^<]*?口诀[^<]*?<\/h[3-4]>/gi,priority:1,name:"h3/h4口诀"},{pattern:/<strong[^>]*>[^<]*?口诀[^<]*?<\/strong>/gi,priority:2,name:"strong口诀"},{pattern:/<h[3-4][^>]*>[^<]*?记忆技巧[^<]*?<\/h[3-4]>/gi,priority:3,name:"h3/h4记忆技巧"},{pattern:/<strong[^>]*>[^<]*?记忆技巧[^<]*?<\/strong>/gi,priority:4,name:"strong记忆技巧"},{pattern:/<h[3-4][^>]*>[^<]*?记忆核心要义[^<]*?<\/h[3-4]>/gi,priority:5,name:"h3/h4记忆核心要义"},{pattern:/<strong[^>]*>[^<]*?记忆核心要义[^<]*?<\/strong>/gi,priority:6,name:"strong记忆核心要义"},{pattern:/<h[3-4][^>]*>[^<]*?核心要义[^<]*?<\/h[3-4]>/gi,priority:7,name:"h3/h4核心要义"},{pattern:/<strong[^>]*>[^<]*?核心要义[^<]*?<\/strong>/gi,priority:8,name:"strong核心要义"}];let r=-1,o=999,e=null;for(const{pattern:c,priority:i,name:a}of n){let f;for(;(f=c.exec(s))!==null;){const l=f.index+f[0].length,g=s.substring(l),m=Z(g);console.log(`找到 ${a} 触发词，位置: ${l}, 内容: ${f[0]}, 有效引号: ${m}`),m&&i<o&&(r=l,o=i,e=a,console.log(`更新最佳匹配: ${a}, 位置: ${l}`))}c.lastIndex=0}return e&&console.log(`最终选择: ${e}, 位置: ${r}`),r}function Z(s){const n=D(s);if(!n)return!1;const r=R(n),o=[/^[a-z-_]+(__[a-z-_]+)*$/i,/^[a-zA-Z0-9-_\/\.]+$/,/^\d+(\.\d+)?%?$/,/^[<>\/=\s]+$/,/^[a-zA-Z\s]+$/];for(const c of o)if(c.test(r))return!1;return/[\u4e00-\u9fa5]/.test(r)&&r.length>=4&&r.length<200}function D(s){let n=null,r=1/0;const o=[{start:34,end:34},{start:8220,end:8221},{start:12300,end:12301},{start:65294,end:65294}];for(const e of o){let c=-1;for(let i=0;i<s.length;i++)if(s.charCodeAt(i)===e.start){c=i;break}if(c!==-1){for(let i=c+1;i<s.length;i++)if(s.charCodeAt(i)===e.end){c<r&&(r=c,n=s.substring(c+1,i));break}}}return n}function R(s){if(!s)return"";let n=s.replace(/<[^>]*>/g,"");return n=n.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/[\u200B\uFEFF]/g,"").replace(/\s+/g," ").trim(),n}function G({folderStructure:s,currentPath:n,onClose:r}){const o=H(),[e,c]=w.useState(()=>{const l=new Set(["root"]);if(n){const g=n.split("/");let m="root";g.forEach(h=>{l.add(m),m=`${m}_${h}`})}return l}),i=l=>{const g=new Set(e);g.has(l)?g.delete(l):g.add(l),c(g)},a=l=>{o(!l||l===""?"/":`/${l}`),r()},f=(l,g,m=0)=>{const h=e.has(g),b=Object.keys(l.folders||{}).length>0,_=l.path===n;return t.jsxs("div",{className:"select-none",children:[t.jsxs("div",{className:`flex items-center py-1 px-2 cursor-pointer hover:bg-gray-100 rounded ${_?"bg-blue-100 text-blue-800":""}`,style:{paddingLeft:`${m*20+8}px`},onClick:()=>a(l.path),children:[b&&t.jsx("button",{className:"mr-1 p-1 hover:bg-gray-200 rounded",onClick:p=>{p.stopPropagation(),i(g)},children:t.jsx("span",{className:`inline-block transition-transform ${h?"rotate-90":""}`,children:"▶"})}),!b&&t.jsx("span",{className:"w-6"}),t.jsxs("span",{className:"text-sm",children:["📁 ",l.name,l.files&&l.files.length>0&&t.jsxs("span",{className:"ml-1 text-xs text-gray-500",children:["(",l.files.length,")"]})]})]}),b&&h&&t.jsx("div",{children:Object.entries(l.folders).map(([p,d])=>f(d,`${g}_${p}`,m+1))})]},g)};return!s||Object.keys(s).length===0?t.jsx("div",{className:"p-4 text-gray-500 text-sm",children:"Loading folder structure..."}):t.jsxs("div",{className:"bg-white border rounded-lg shadow-lg max-h-96 overflow-y-auto",children:[t.jsx("div",{className:"sticky top-0 bg-gray-50 px-4 py-2 border-b",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Folder Navigator"}),t.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:"✕"})]})}),t.jsx("div",{className:"p-2",children:Object.entries(s).map(([l,g])=>f(g,l))})]})}function X({notes:s,selectNote:n,isSidebarOpen:r,selectedNote:o,setIsSidebarOpen:e,folderStructure:c,currentFolder:i,currentPath:a}){const[f,l]=w.useState(""),[g,m]=w.useState(!0),[h,b]=w.useState(!1),_=H(),p=()=>{e(!r)},d=()=>{if(!a)return;const u=a.split("/");if(u.length>1){u.pop();const y=u.join("/");_(`/${y}`)}else _("/")},x=()=>{if(!a)return t.jsxs("div",{className:"mb-2 text-xs text-gray-600 bg-gray-50 p-2 rounded",children:["📂 ",t.jsx("span",{className:"font-medium",children:"根目录"})]});const u=a.split("/"),y=[];y.push(t.jsx("button",{onClick:()=>_("/"),className:"hover:text-blue-600 underline",children:"根目录"},"root"));let $="";return u.forEach((M,C)=>{$=$?`${$}/${M}`:M;const I=C===u.length-1;if(y.push(t.jsx("span",{className:"text-gray-400 mx-1",children:"/"},`separator-${C}`)),I)y.push(t.jsx("span",{className:"font-medium text-blue-600",children:M},M));else{const W=$;y.push(t.jsx("button",{onClick:()=>_(`/${W}`),className:"hover:text-blue-600 underline",children:M},M))}}),t.jsxs("div",{className:"mb-2 text-xs text-gray-600 bg-gray-50 p-2 rounded",children:["📂 ",y]})},v=s.filter(u=>{const y=u.title||"Untitled",$=u.content||"",M=f.toLowerCase();return y.toLowerCase().includes(M)||$.toLowerCase().includes(M)}),j=u=>g?T(u.content):null,N=s.filter(u=>T(u.content)).length;return t.jsxs("div",{children:[t.jsx("button",{className:"fixed bottom-4 right-4 z-50 p-3 bg-blue-500 text-white rounded-full shadow-lg md:hidden",onClick:p,children:r?"Close":"Open"}),t.jsxs("div",{className:`fixed top-0 left-0 h-full w-64 bg-white shadow-lg transform transition-transform ${r?"translate-x-0 z-10":"-translate-x-full"} md:translate-x-0 md:relative md:block`,children:[t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h2",{className:"text-lg font-semibold",children:"Notes"}),t.jsxs("div",{className:"flex items-center space-x-1",children:[a&&t.jsx("button",{onClick:d,className:"p-1 hover:bg-gray-200 rounded",title:"返回上级文件夹",children:"⬆️"}),t.jsx("button",{onClick:()=>b(!h),className:"p-1 hover:bg-gray-200 rounded",title:"文件夹导航",children:"📁"})]})]}),x(),h&&t.jsx("div",{className:"absolute top-16 left-0 right-0 z-20 mx-4",children:t.jsx(G,{folderStructure:c,currentPath:a,onClose:()=>b(!1)})}),t.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["总共 ",s.length," 条笔记",g&&t.jsxs("span",{children:[" | 包含口诀: ",N," 条"]})]}),t.jsx("button",{onClick:()=>m(!g),className:`w-full mt-2 p-2 rounded-md text-sm font-medium transition-colors ${g?"bg-green-500 text-white hover:bg-green-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:g?"🧠 口诀模式 (开启)":"🧠 口诀模式 (关闭)"}),t.jsx("input",{type:"text",placeholder:"Search notes...",className:"w-full mt-2 p-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:f,onChange:u=>l(u.target.value)})]}),t.jsx("ul",{className:"overflow-y-auto h-[calc(100vh-200px)]",children:v.length>0?v.map(u=>{const y=j(u);return t.jsxs("li",{className:`p-4 cursor-pointer hover:bg-gray-100 ${o&&o.id===u.id?"bg-gray-200":""}`,onClick:()=>n(u),children:[t.jsx("span",{className:"text-sm",children:u.title||"Untitled"}),y&&t.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border-l-3 border-yellow-400 rounded",children:t.jsx("p",{className:"text-xs text-yellow-800 font-medium",children:y})}),t.jsx("p",{className:"text-xs text-gray-500",children:new Date(u.createdAt).toLocaleString()})]},u.id)}):t.jsx("li",{className:"p-4 text-sm text-gray-500",children:g?"No notes with mnemonics found":"No notes found"})})]})]})}const L=q.memo(({chart:s,id:n})=>{const r=w.useRef(null),o=e=>e&&e.replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\\/g,"\\\\").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"\\n").replace(/\r/g,"\\r");return w.useEffect(()=>{k.initialize({startOnLoad:!1,theme:"default",securityLevel:"loose",fontFamily:'"trebuchet ms", verdana, arial, sans-serif',flowchart:{useMaxWidth:!0,htmlLabels:!0,curve:"linear"},pie:{useMaxWidth:!0,useMaxHeight:!0,textPosition:.75,useWidth:600,useHeight:400},sequence:{diagramMarginX:50,diagramMarginY:10,actorMargin:50,width:150,height:65,boxMargin:10,boxTextMargin:5,noteMargin:10,messageMargin:35,mirrorActors:!0,bottomMarginAdj:1,useMaxWidth:!0,rightAngles:!1,showSequenceNumbers:!1,actorFontSize:14,actorFontFamily:'"trebuchet ms", verdana, arial, sans-serif',noteFontSize:12,noteFontFamily:'"trebuchet ms", verdana, arial, sans-serif',messageFontSize:12,messageFontFamily:'"trebuchet ms", verdana, arial, sans-serif'}})},[]),w.useEffect(()=>{if(!s||!r.current)return;const e=r.current;if(e.dataset.rendering==="true")return;e.dataset.rendering="true",(async()=>{try{console.log("Rendering Mermaid chart:",s),e.innerHTML="";const i=`mermaid-${n||Math.random().toString(36).substr(2,9)}`;let a=s.trim();console.log("Applying global Chinese punctuation normalization"),a=a.replace(/“/g,'"').replace(/”/g,'"').replace(/：/g,":"),a.startsWith("pie")?(console.log("Processing pie chart"),a=a.split(`
`).map(g=>{let m=g.trim();return m.startsWith("title ")||m==="pie"||m.includes('"')&&m.includes(":")&&(m=m.replace(/^(\s*)"([^"]+)"\s*:\s*(\d+)\s*$/,'"$2": $3').replace(/^(\s*)"([^"]+)":\s*(\d+)\s*$/,'"$2": $3').replace(/^(\s*)"([^"]+)"\s*:(\d+)\s*$/,'"$2": $3').replace(/^(\s*)"([^"]+)"\s*:\s*(\d+)/,'"$2": $3')),m}).filter(g=>g.length>0).join(`
`),console.log("Processed pie chart:",a)):a.startsWith("sequenceDiagram")?(console.log("Processing sequence diagram"),a=a.split(`
`).map(m=>{let h=m.trim();return h?(h=h.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'"),h=h.replace(/\s*-\s*>\s*>\s*\+/g,"->>+").replace(/\s*-\s*>\s*>/g,"->>").replace(/\s*-\s*-\s*>\s*>/g,"-->>"),h):""}).filter(m=>m.length>0).join(`
`),console.log("Processed sequence diagram:",a)):(a=a.replace(/(\[)([^\]]*?)(\])/g,(g,m,h,b)=>m+o(h)+b),a=a.replace(/(\()([^)]*?)(\))/g,(g,m,h,b)=>m+o(h)+b),a=a.replace(/(\|)([^|]*?)(\|)/g,(g,m,h,b)=>m+o(h)+b)),(a.startsWith("graph ")||a.startsWith("flowchart "))&&!a.includes(`
`)&&(a=a.replace(/(graph\s+\w+|flowchart\s+\w+)\s+(.+)/,(g,m,h)=>{const b=h.replace(/\s+([A-Z0-9]+(?:\[[^\]]+\]|\([^)]+\))?)\s+-->/g,`
    $1 -->`).replace(/-->\s*\|([^|]+)\|\s*([A-Z0-9]+(?:\[[^\]]+\]|\([^)]+\))?)/g,"-->|$1| $2");return m+b})),console.log("Processed chart:",a);try{await k.parse(a),console.log("Mermaid parse validation successful")}catch(g){console.warn("Mermaid parse validation failed, but continuing with render:",g),a.includes("sequenceDiagram")&&(console.log("Attempting to fix sequence diagram syntax"),a=a.replace(/：/g,":").replace(/（/g,"(").replace(/）/g,")").replace(/≥/g,">=").replace(/《/g,'"').replace(/》/g,'"'),console.log("Fixed sequence diagram:",a))}const{svg:f}=await k.render(i,a);console.log("Mermaid render successful, SVG length:",f.length),e.innerHTML=f,console.log("Container after SVG insertion:",e),console.log("Container innerHTML length:",e.innerHTML.length);const l=e.querySelector("svg");l?(l.style.maxWidth="100%",l.style.height="auto",l.style.display="block",l.style.visibility="visible",a.startsWith("pie")&&(l.style.minHeight="400px",l.style.maxWidth="600px",l.style.margin="0 auto",e.style.textAlign="center",console.log("Applied pie chart specific styles")),console.log("SVG element configured successfully"),console.log("SVG dimensions:",{width:l.getAttribute("width"),height:l.getAttribute("height"),viewBox:l.getAttribute("viewBox")})):console.error("SVG element not found after insertion"),e.dataset.rendering="false"}catch(i){console.error("Mermaid rendering error:",i),console.error("Original chart content:",s),console.error("Processed chart content:",processedChart||s),e.dataset.rendering="false",e.innerHTML=`
          <div style="
            color: #d73a49; 
            background: #ffeef0; 
            border: 1px solid #fdaeb7; 
            border-radius: 6px; 
            padding: 16px; 
            margin: 10px 0;
            font-family: monospace;
          ">
            <strong>Diagram Error:</strong><br/>
            ${i.message.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}
            <details style="margin-top: 8px;">
              <summary>Show original diagram code</summary>
              <pre style="margin-top: 8px; white-space: pre-wrap;">${s.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}</pre>
            </details>
            <details style="margin-top: 8px;">
              <summary>Show processed diagram code</summary>
              <pre style="margin-top: 8px; white-space: pre-wrap;">${(processedChart||s).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}</pre>
            </details>
          </div>
        `}})()},[s,n]),t.jsx("div",{ref:r,className:"mermaid-diagram",style:{textAlign:"center",maxWidth:"100%",overflow:"auto",margin:"20px 0",minHeight:"100px"}})});function Y(){const s=`
    <code class="language-mermaid">
      <span class="hljs-selector-tag">graph</span> <span class="hljs-selector-tag">LR</span>  
      <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[可能性]</span> <span class="hljs-comment">--&gt;|最低| D[高度可能性]&lt;br&gt;（50%+）</span>
      <span class="hljs-selector-tag">A</span> <span class="hljs-comment">--&gt;|中级| E[排除合理怀疑]&lt;br&gt;（90%+）</span>
      <span class="hljs-selector-tag">A</span> <span class="hljs-comment">--&gt;|最高| F[排除一切怀疑]&lt;br&gt;（100%）</span>
    </code>
  `;console.log("=== 开始测试 Mermaid 提取 (包含<br>标签) ==="),console.log("测试HTML:",s);const o=new DOMParser().parseFromString(s,"text/html").querySelector(".language-mermaid");if(o){console.log("找到 mermaid 元素，开始提取...");const e=O(o.innerHTML);return console.log("=== 提取完成 ==="),console.log("提取的 Mermaid 代码:"),console.log(e),console.log("预期结果应该是干净的 Mermaid 语法，无 HTML 标签，<br>应转换为换行"),e}else console.log("未找到 mermaid 元素");return null}typeof window<"u"&&(window.testMermaidHelper=Y,console.log("已注册全局测试函数: window.testMermaidHelper()"));function O(s){if(console.log("=== cleanMermaidCode 开始处理 ==="),console.log("Raw Mermaid code input:",s),console.log("Raw code type:",typeof s),console.log("Raw code length:",s==null?void 0:s.length),!s||typeof s!="string")return console.log("Invalid input, returning empty string"),"";let n=s;if(s.includes("<")&&s.includes(">")){console.log("检测到HTML标签，开始去除...");let o=s.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&nbsp;/g," ").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/<br\s*\/?>/gi," ").replace(/&lt;br\s*\/?&gt;/gi," ");console.log("HTML实体处理后:",o);const e=document.createElement("div");e.innerHTML=o,n=e.textContent||e.innerText||"",console.log("HTML标签去除后:",n)}if(n.startsWith("mindmap"))return console.log("检测到 mindmap 图，使用专用清理函数"),J(n);const r=n.replace(/[ \t]+/g," ").replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/《/g,"「").replace(/》/g,"」").replace(/（/g,"(").replace(/）/g,")").replace(/：/g,":").replace(/；/g,";").replace(/，/g,",").replace(/。/g,".").split(`
`).map(o=>{let e=o.trim();return e.length===0?null:(console.log("处理行:",e),e.includes("[")&&e.includes("]")&&(e=e.replace(/\[([^\]]+)\]/g,(c,i)=>`[${i.replace(/《/g,'"').replace(/》/g,'"').replace(/:/g,"-").replace(/\[/g,"(").replace(/\]/g,")").replace(/"/g,"'").replace(/`/g,"'").replace(/\(([一二三四五六七八九十]+)\)/g,"-$1-").replace(/\[([一二三四五六七八九十]+)\]/g,"-$1-").replace(/（([一二三四五六七八九十]+)）/g,"-$1-").trim()}]`),console.log("节点标签清理后:",e)),(e.includes("sequenceDiagram")||e.includes("->")||e.includes("--")||e.includes("loop")||e.includes("end"))&&(e=e.replace(/\s*-\s*>\s*>\s*\+/g,"->>+").replace(/\s*-\s*>\s*>/g,"->>").replace(/\s*-\s*-\s*>\s*>/g,"-->>"),console.log("序列图语法修复后:",e)),e)}).filter(o=>o!==null&&o.length>0).join(`
`).trim();return console.log("最终清理后的 Mermaid 代码:"),console.log(r),console.log("最终代码长度:",r.length),(r.includes("<")||r.includes(">"))&&console.warn("警告：清理后的代码仍包含HTML标签:",r),console.log("=== cleanMermaidCode 处理完成 ==="),r}function J(s){console.log("=== cleanMermaidCode 开始处理 ===");const n=s.replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/《/g,"「").replace(/》/g,"」").replace(/（/g,"【").replace(/）/g,"】").replace(/\(/g,"【").replace(/\)/g,"】").replace(/：/g,":").replace(/；/g,";").replace(/，/g,",").replace(/。/g,".").split(`
`).map(r=>{const o=r.match(/^[ \t]*/)[0];let e=r.replace("<br>",`
  ${o}`);return e.length===0?null:(console.log("处理行:",e),e.includes("[")&&e.includes("]")&&(e=e.replace(/\[([^\]]+)\]/g,(c,i)=>`[${i.replace(/《/g,'"').replace(/》/g,'"').replace(/:/g,"-").replace(/\[/g,"(").replace(/\]/g,")").replace(/"/g,"'").replace(/`/g,"'").replace(/\(([一二三四五六七八九十]+)\)/g,"-$1-").replace(/\[([一二三四五六七八九十]+)\]/g,"-$1-").replace(/（([一二三四五六七八九十]+)）/g,"-$1-")}]`),console.log("节点标签清理后:",e)),(e.includes("sequenceDiagram")||e.includes("->")||e.includes("--")||e.includes("loop")||e.includes("end"))&&(e=e.replace(/\s*-\s*>\s*>\s*\+/g,"->>+").replace(/\s*-\s*>\s*>/g,"->>").replace(/\s*-\s*-\s*>\s*>/g,"-->>"),console.log("序列图语法修复后:",e)),e)}).filter(r=>r!==null&&r.length>0).join(`
`).trim();return console.log("最终清理后的 Mermaid 代码:"),console.log(n),console.log("最终代码长度:",n.length),(n.includes("<")||n.includes(">"))&&console.warn("警告：清理后的代码仍包含HTML标签:",n),console.log("=== cleanMermaidCode 处理完成 ==="),n}function K({note:s,onClick:n}){const[r,o]=w.useState(""),[e,c]=w.useState([]);w.useEffect(()=>{if(!s||!s.content){o(""),c([]);return}const b=new DOMParser().parseFromString(s.content,"text/html"),_=b.querySelectorAll(".language-mermaid, code.language-mermaid, .hyc-common-markdown__code-mermaid code"),p=[];_.forEach((d,x)=>{console.log(`Processing Mermaid element ${x}:`,d),console.log("Element className:",d.className),console.log("Element tagName:",d.tagName);let v=d.innerHTML||d.textContent||d.innerText;console.log(`Raw content for chart ${x}:`,v),!v&&d.parentElement&&(v=d.parentElement.textContent||d.parentElement.innerText,console.log(`Fallback content from parent for chart ${x}:`,v));const j=O(v);if(j&&j.trim().length>0){const N=`mermaid-chart-${x}`;p.push({id:N,code:j}),console.log(`Successfully extracted Mermaid chart ${N}:`,j);let u=d.closest(".hyc-common-markdown__code-mermaid")||d.closest(".hyc-common-markdown__code-mermaid-show-svg")||d.closest(".hyc-common-markdown__code")||d.closest("pre")||d.parentElement;if(u){const y=b.createElement("div");y.className="mermaid-placeholder",y.setAttribute("data-chart-id",N),y.style.cssText="min-height: 200px; text-align: center; padding: 20px; border: 1px solid #e1e5e9; border-radius: 6px; margin: 20px 0; background-color: #f6f8fa;",y.innerHTML=`<div style="color: #666;">Loading Mermaid diagram ${x+1}...</div>`,u.parentNode.replaceChild(y,u)}}else console.warn(`No valid Mermaid code found in element ${x}`,{element:d,rawContent:v,cleanedCode:j})}),console.log(`Found ${p.length} Mermaid charts in total`),c(d=>d.length!==p.length||d.some((v,j)=>p[j]&&(v.id!==p[j].id||v.code!==p[j].code))?p:d),o(b.body.innerHTML)},[s]);const i=()=>e.map(h=>t.jsx("div",{id:h.id,style:{margin:"20px 0"},children:t.jsx(L,{chart:h.code,id:h.id})},h.id)),a=()=>{if(!r)return t.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:r}});if(e.length===0)return t.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:r}});const _=new DOMParser().parseFromString(r,"text/html").querySelectorAll(".mermaid-placeholder"),p=[];if(_.length===0)p.push(t.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:r}},"main-content")),p.push(...i());else{let d=r;e.forEach((x,v)=>{const j=new RegExp(`<div[^>]*class="[^"]*mermaid-placeholder[^"]*"[^>]*data-chart-id="${x.id}"[^>]*>.*?</div>`,"g");if(j.test(d)){const N=d.split(j);N[0]&&p.push(t.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:N[0]}},`content-before-${v}`)),p.push(t.jsx("div",{style:{margin:"20px 0"},children:t.jsx(L,{chart:x.code,id:x.id})},x.id)),d=N.slice(1).join("")}}),d&&p.push(t.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:d}},"remaining-content"))}return p};if(!s)return t.jsx("div",{className:"text-gray-500",onClick:n,children:"Select a note to view"});const l=(()=>!s||!s.content?"reasoner":s.content.includes("hyc-component-text")?"text":(s.content.includes("hyc-component-reasoner__text"),"reasoner"))(),g=()=>t.jsx("div",{className:"yb-layout__content agent-layout__content",onClick:n,children:t.jsx("div",{className:"agent-dialogue",children:t.jsx("div",{className:"agent-dialogue__content-wrapper",children:t.jsx("div",{className:"agent-dialogue__content",children:t.jsx("div",{className:"agent-dialogue__content--common",children:t.jsx("div",{className:"agent-dialogue__content--common__content",id:"chat-content",children:t.jsx("div",{className:"agent-chat__list agent-chat__list__deepseek",children:t.jsx("div",{className:"agent-chat__list__content-wrapper",children:t.jsxs("div",{className:"agent-chat__list__content",style:{marginRight:"0px"},children:[t.jsx("div",{className:"agent-chat__list__item agent-chat__list__item--ai agent-chat__list__item--last p-0","data-conv-idx":"158","data-conv-speaker":"ai","data-conv-speech-mode":"0","data-conv-sensitive":"false",children:t.jsx("div",{className:"",children:t.jsx("div",{className:"agent-chat__speech-text--box agent-chat__speech-text--box-left",style:{width:"100%"},children:t.jsx("div",{className:"agent-chat__speech-text",children:t.jsx("div",{className:"hyc-component-text",children:a()})})})})}),t.jsx("div",{className:"agent-chat__list__placeholder"})]})})})})})})})})}),m=()=>t.jsx("div",{className:"yb-layout__content agent-layout__content",onClick:n,children:t.jsx("div",{className:"agent-dialogue",children:t.jsx("div",{className:"agent-dialogue__content-wrapper",children:t.jsx("div",{className:"agent-dialogue__content",children:t.jsx("div",{className:"agent-dialogue__content--common",children:t.jsx("div",{className:"agent-dialogue__content--common__content",id:"chat-content",children:t.jsx("div",{className:"agent-chat__list",children:t.jsx("div",{className:"agent-chat__list__content-wrapper",children:t.jsxs("div",{className:"agent-chat__list__content",style:{marginRight:"0px"},children:[t.jsx("div",{className:"agent-chat__list__item agent-chat__list__item--ai agent-chat__list__item--last p-0","data-conv-idx":"158","data-conv-speaker":"ai","data-conv-speech-mode":"0","data-conv-sensitive":"false","data-conv-id":"b5e1d739-7f95-4221-bc59-0c8cf5dda717_158",children:t.jsx("div",{className:"agent-chat__list__item__content",children:t.jsx("div",{className:"agent-chat__bubble agent-chat__bubble--ai",children:t.jsx("div",{className:"agent-chat__bubble__content",children:t.jsx("div",{className:"agent-chat__conv--ai__speech_show","data-conv-index":"79","data-speech-index":"0",children:t.jsx("div",{className:"hyc-component-reasoner",children:a()})})})})})}),t.jsx("div",{className:"agent-chat__list__placeholder"})]})})})})})})})})});return l==="text"?g():m()}function A(s){const o=new DOMParser().parseFromString(s,"text/html").querySelector("h3");if(!o)return"Untitled";let e=o.textContent.trim();const c=["法考知识点解析：","法考知识点解析:","法考知识点解析","核心知识点：","核心知识点:","总标题：","总标题:","考点"];for(const i of c){const a=e.replace(/^[\s\u200B\uFEFF\u00A0]+/,"");if(a.startsWith(i)){e=a.substring(i.length).trim();break}}return e||"Untitled"}async function ee(){try{const n=await fetch("/yuanbao-note-viewer/notes/index.json");if(!n.ok)throw new Error("Failed to fetch index.json");const r=await n.json(),o={root:{path:"",name:"All Notes",files:[],folders:{}}};return r.forEach(e=>{if(!e.folder||e.folder==="")o.root.files.push(e);else{const c=e.folder.split("/");let i=o.root.folders,a="";for(let f=0;f<c.length;f++){const l=c[f];a=a?`${a}/${l}`:l,i[l]||(i[l]={path:a,name:l,files:[],folders:{}}),f===c.length-1?i[l].files.push(e):i=i[l].folders}}}),o}catch(s){return console.error("Error scanning folder structure:",s),{root:{path:"",name:"All Notes",files:[],folders:{}}}}}function te(s,n){if(!n||n===""||n==="/")return s.root||{path:"",name:"All Notes",files:[],folders:{}};const r=n.split("/").filter(e=>e!=="");let o=s.root.folders;for(let e=0;e<r.length;e++){const c=r[e];if(o[c]){if(e===r.length-1)return o[c];o=o[c].folders}else return null}return null}function se(){const{"*":s}=z(),[n,r]=w.useState([]),[o,e]=w.useState(null),[c,i]=w.useState({}),[a,f]=w.useState(null),[l,g]=w.useState(!0);w.useEffect(()=>{(async()=>{g(!0);try{const p=await ee();i(p);const d=te(p,s||"");f(d),d&&d.files?await m(d.files):(r([]),e(null))}catch(p){console.error("Error loading notes for folder:",p),r([]),e(null)}finally{g(!1)}})()},[s]);const m=async _=>{try{const d=(await Promise.all(_.map(async x=>{const N=await(await fetch(`/yuanbao-note-viewer/${x.path.replace(/^\//,"")}`)).text(),u=S(N,{allowedTags:S.defaults.allowedTags.concat(["h3","table","thead","tbody","tr","th","td","hr","ol","ul","li","blockquote","pre","code","span","svg","g","path","rect","circle","ellipse","polygon","foreignObject","marker","defs","style"]),allowedAttributes:{"*":["class","id","style"],div:["style","data-*"],pre:["class"],code:["class"],span:["class"],svg:["width","height","viewBox","xmlns","role","aria-roledescription","xmlns:xlink","xmlns:ev"],g:["id","class","transform"],path:["d","class","style","fill","stroke","stroke-width","marker-end"],rect:["x","y","width","height","class","style","fill","stroke","rx","ry"],circle:["cx","cy","r","class","style","fill","stroke"],foreignObject:["width","height"],marker:["id","class","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","orient"],table:["style"],th:["style"],td:["style"]},allowedSchemes:["http","https","data"],allowedStyles:{"*":{"font-family":[/^.*$/],"font-size":[/^.*$/],color:[/^.*$/],"line-height":[/^.*$/],padding:[/^.*$/],margin:[/^.*$/],"text-align":[/^.*$/],"font-weight":[/^.*$/],"font-style":[/^.*$/],"background-color":[/^.*$/],border:[/^.*$/],width:[/^.*$/],height:[/^.*$/],"max-width":[/^.*$/],"max-height":[/^.*$/],"white-space":[/^.*$/],"word-break":[/^.*$/],display:[/^.*$/],"box-sizing":[/^.*$/],position:[/^.*$/],top:[/^.*$/],left:[/^.*$/],right:[/^.*$/],bottom:[/^.*$/],transform:[/^.*$/],stroke:[/^.*$/],"stroke-width":[/^.*$/],"stroke-dasharray":[/^.*$/],fill:[/^.*$/],overflow:[/^.*$/]}},transformTags:{style:()=>({tagName:"",attribs:{},text:""})}}),y=A(u),$=E(x.file);return{id:x.file,title:y,content:u,createdAt:$,folder:x.folder||""}}))).sort((x,v)=>v.createdAt-x.createdAt);r(d),d.length>0?e(d[0]):e(null)}catch(p){console.error("Error loading notes:",p),r([]),e(null)}};return{notes:n,selectedNote:o,selectNote:_=>{e(_)},addNote:(_,p)=>{const d=S(p,{allowedTags:S.defaults.allowedTags.concat(["h3","table","thead","tbody","tr","th","td","hr","ol","ul","li","blockquote"]),allowedAttributes:{"*":["class"],div:["style"],table:["style"],th:["style"],td:["style"]},allowedStyles:{"*":{"font-family":[/^.*$/],"font-size":[/^.*$/],color:[/^.*$/],"line-height":[/^.*$/],padding:[/^.*$/],margin:[/^.*$/],"text-align":[/^.*$/],"font-weight":[/^.*$/],"font-style":[/^.*$/],"background-color":[/^.*$/],border:[/^.*$/],width:[/^.*$/],"white-space":[/^.*$/],"word-break":[/^.*$/],display:[/^.*$/],"box-sizing":[/^.*$/]}},transformTags:{style:()=>({tagName:"",attribs:{},text:""})}}),x=A(d),v=E(_)||Date.now(),j={id:_,title:x,content:d,createdAt:v,folder:s||""};r(N=>{const u=[j,...N].sort((y,$)=>$.createdAt-y.createdAt);return e(j),u})},folderStructure:c,currentFolder:a,isLoading:l,currentPath:s||""}}function E(s){const n=s.match(/note-(\d{14})\.html/);if(!n)return Date.now();const[r,o,e,c,i,a]=[n[1].slice(0,4),n[1].slice(4,6),n[1].slice(6,8),n[1].slice(8,10),n[1].slice(10,12),n[1].slice(12,14)],f=`${r}-${o}-${e}T${c}:${i}:${a}Z`,l=new Date(f);return new Date(l.toLocaleString("en-US",{timeZone:"Asia/Shanghai"})).getTime()}function P(){const{notes:s,selectedNote:n,selectNote:r,folderStructure:o,currentFolder:e,isLoading:c,currentPath:i}=se(),[a,f]=w.useState(!1);return c?t.jsx("div",{className:"yb-layout agent-layout layout-pc flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),t.jsx("p",{className:"mt-4 text-gray-600",children:"Loading notes..."})]})}):t.jsxs("div",{className:"yb-layout agent-layout layout-pc flex flex-row",children:[t.jsx(X,{notes:s,selectNote:r,selectedNote:n,isSidebarOpen:a,setIsSidebarOpen:f,folderStructure:o,currentFolder:e,currentPath:i}),t.jsx(K,{note:n,onClick:()=>f(!1)})]})}function ne(){return t.jsx(B,{basename:"/yuanbao-note-viewer",children:t.jsxs(V,{children:[t.jsx(F,{path:"/",element:t.jsx(P,{})}),t.jsx(F,{path:"/*",element:t.jsx(P,{})})]})})}Q.createRoot(document.getElementById("app")).render(t.jsx(q.StrictMode,{children:t.jsx(ne,{})}));
