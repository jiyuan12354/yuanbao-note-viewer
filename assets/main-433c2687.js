import{u as H,r as w,j as e,R as q,m as F,a as W,s as S,B,b as V,c as T,d as Q}from"./vendor-4271a838.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const c of t)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function r(t){const c={};return t.integrity&&(c.integrity=t.integrity),t.referrerPolicy&&(c.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?c.credentials="include":t.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(t){if(t.ep)return;t.ep=!0;const c=r(t);fetch(t.href,c)}})();function C(s){if(!s)return null;const n=Z(s);if(n===-1)return null;const r=s.substring(n),a=D(r);return a?R(a):null}function Z(s){const n=[{pattern:/<h[3-4][^>]*>[^<]*?口诀[^<]*?<\/h[3-4]>/gi,priority:1,name:"h3/h4口诀"},{pattern:/<strong[^>]*>[^<]*?口诀[^<]*?<\/strong>/gi,priority:2,name:"strong口诀"},{pattern:/<h[3-4][^>]*>[^<]*?记忆技巧[^<]*?<\/h[3-4]>/gi,priority:3,name:"h3/h4记忆技巧"},{pattern:/<strong[^>]*>[^<]*?记忆技巧[^<]*?<\/strong>/gi,priority:4,name:"strong记忆技巧"},{pattern:/<h[3-4][^>]*>[^<]*?记忆核心要义[^<]*?<\/h[3-4]>/gi,priority:5,name:"h3/h4记忆核心要义"},{pattern:/<strong[^>]*>[^<]*?记忆核心要义[^<]*?<\/strong>/gi,priority:6,name:"strong记忆核心要义"},{pattern:/<h[3-4][^>]*>[^<]*?核心要义[^<]*?<\/h[3-4]>/gi,priority:7,name:"h3/h4核心要义"},{pattern:/<strong[^>]*>[^<]*?核心要义[^<]*?<\/strong>/gi,priority:8,name:"strong核心要义"}];let r=-1,a=999,t=null;for(const{pattern:c,priority:d,name:o}of n){let f;for(;(f=c.exec(s))!==null;){const l=f.index+f[0].length,g=s.substring(l),m=G(g);console.log(`找到 ${o} 触发词，位置: ${l}, 内容: ${f[0]}, 有效引号: ${m}`),m&&d<a&&(r=l,a=d,t=o,console.log(`更新最佳匹配: ${o}, 位置: ${l}`))}c.lastIndex=0}return t&&console.log(`最终选择: ${t}, 位置: ${r}`),r}function G(s){const n=D(s);if(!n)return!1;const r=R(n),a=[/^[a-z-_]+(__[a-z-_]+)*$/i,/^[a-zA-Z0-9-_\/\.]+$/,/^\d+(\.\d+)?%?$/,/^[<>\/=\s]+$/,/^[a-zA-Z\s]+$/];for(const c of a)if(c.test(r))return!1;return/[\u4e00-\u9fa5]/.test(r)&&r.length>=4&&r.length<200}function D(s){let n=null,r=1/0;const a=[{start:34,end:34},{start:8220,end:8221},{start:12300,end:12301},{start:65294,end:65294}];for(const t of a){let c=-1;for(let d=0;d<s.length;d++)if(s.charCodeAt(d)===t.start){c=d;break}if(c!==-1){for(let d=c+1;d<s.length;d++)if(s.charCodeAt(d)===t.end){c<r&&(r=c,n=s.substring(c+1,d));break}}}return n}function R(s){if(!s)return"";let n=s.replace(/<[^>]*>/g,"");return n=n.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/[\u200B\uFEFF]/g,"").replace(/\s+/g," ").trim(),n}function U({folderStructure:s,currentPath:n,onClose:r}){const a=H(),[t,c]=w.useState(()=>{const l=new Set(["root"]);if(n){const g=n.split("/");let m="root";g.forEach(u=>{l.add(m),m=`${m}_${u}`})}return l}),d=l=>{const g=new Set(t);g.has(l)?g.delete(l):g.add(l),c(g)},o=l=>{a(!l||l===""?"/":`/${l}`),r()},f=(l,g,m=0)=>{const u=t.has(g),b=Object.keys(l.folders||{}).length>0,_=l.path===n;return e.jsxs("div",{className:"select-none",children:[e.jsxs("div",{className:`flex items-center py-1 px-2 cursor-pointer hover:bg-gray-100 rounded ${_?"bg-blue-100 text-blue-800":""}`,style:{paddingLeft:`${m*20+8}px`},onClick:()=>o(l.path),children:[b&&e.jsx("button",{className:"mr-1 p-1 hover:bg-gray-200 rounded",onClick:p=>{p.stopPropagation(),d(g)},children:e.jsx("span",{className:`inline-block transition-transform ${u?"rotate-90":""}`,children:"▶"})}),!b&&e.jsx("span",{className:"w-6"}),e.jsxs("span",{className:"text-sm",children:["📁 ",l.name,l.files&&l.files.length>0&&e.jsxs("span",{className:"ml-1 text-xs text-gray-500",children:["(",l.files.length,")"]})]})]}),b&&u&&e.jsx("div",{children:Object.entries(l.folders).map(([p,i])=>f(i,`${g}_${p}`,m+1))})]},g)};return!s||Object.keys(s).length===0?e.jsx("div",{className:"p-4 text-gray-500 text-sm",children:"Loading folder structure..."}):e.jsxs("div",{className:"bg-white border rounded-lg shadow-lg max-h-96 overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gray-50 px-4 py-2 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Folder Navigator"}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:"✕"})]})}),e.jsx("div",{className:"p-2",children:Object.entries(s).map(([l,g])=>f(g,l))})]})}function X({notes:s,selectNote:n,isSidebarOpen:r,selectedNote:a,setIsSidebarOpen:t,folderStructure:c,currentFolder:d,currentPath:o}){const[f,l]=w.useState(""),[g,m]=w.useState(!0),[u,b]=w.useState(!1),_=H(),p=()=>{t(!r)},i=()=>{if(!o)return;const h=o.split("/");if(h.length>1){h.pop();const y=h.join("/");_(`/${y}`)}else _("/")},x=()=>{if(!o)return e.jsxs("div",{className:"mb-2 text-xs text-gray-600 bg-gray-50 p-2 rounded",children:["📂 ",e.jsx("span",{className:"font-medium",children:"根目录"})]});const h=o.split("/"),y=[];y.push(e.jsx("button",{onClick:()=>_("/"),className:"hover:text-blue-600 underline",children:"根目录"},"root"));let $="";return h.forEach((M,k)=>{$=$?`${$}/${M}`:M;const I=k===h.length-1;if(y.push(e.jsx("span",{className:"text-gray-400 mx-1",children:"/"},`separator-${k}`)),I)y.push(e.jsx("span",{className:"font-medium text-blue-600",children:M},M));else{const z=$;y.push(e.jsx("button",{onClick:()=>_(`/${z}`),className:"hover:text-blue-600 underline",children:M},M))}}),e.jsxs("div",{className:"mb-2 text-xs text-gray-600 bg-gray-50 p-2 rounded",children:["📂 ",y]})},v=s.filter(h=>{const y=h.title||"Untitled",$=h.content||"",M=f.toLowerCase();return y.toLowerCase().includes(M)||$.toLowerCase().includes(M)}),j=h=>g?C(h.content):null,N=s.filter(h=>C(h.content)).length;return e.jsxs("div",{children:[e.jsx("button",{className:"fixed bottom-4 right-4 z-50 p-3 bg-blue-500 text-white rounded-full shadow-lg md:hidden",onClick:p,children:r?"Close":"Open"}),e.jsxs("div",{className:`fixed top-0 left-0 h-full w-64 bg-white shadow-lg transform transition-transform ${r?"translate-x-0 z-10":"-translate-x-full"} md:translate-x-0 md:relative md:block`,children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Notes"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[o&&e.jsx("button",{onClick:i,className:"p-1 hover:bg-gray-200 rounded",title:"返回上级文件夹",children:"⬆️"}),e.jsx("button",{onClick:()=>b(!u),className:"p-1 hover:bg-gray-200 rounded",title:"文件夹导航",children:"📁"})]})]}),x(),u&&e.jsx("div",{className:"absolute top-16 left-0 right-0 z-20 mx-4",children:e.jsx(U,{folderStructure:c,currentPath:o,onClose:()=>b(!1)})}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["总共 ",s.length," 条笔记",g&&e.jsxs("span",{children:[" | 包含口诀: ",N," 条"]})]}),e.jsx("button",{onClick:()=>m(!g),className:`w-full mt-2 p-2 rounded-md text-sm font-medium transition-colors ${g?"bg-green-500 text-white hover:bg-green-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:g?"🧠 口诀模式 (开启)":"🧠 口诀模式 (关闭)"}),e.jsx("input",{type:"text",placeholder:"Search notes...",className:"w-full mt-2 p-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:f,onChange:h=>l(h.target.value)})]}),e.jsx("ul",{className:"overflow-y-auto h-[calc(100vh-200px)]",children:v.length>0?v.map(h=>{const y=j(h);return e.jsxs("li",{className:`p-4 cursor-pointer hover:bg-gray-100 ${a&&a.id===h.id?"bg-gray-200":""}`,onClick:()=>n(h),children:[e.jsx("span",{className:"text-sm",children:h.title||"Untitled"}),y&&e.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border-l-3 border-yellow-400 rounded",children:e.jsx("p",{className:"text-xs text-yellow-800 font-medium",children:y})}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(h.createdAt).toLocaleString()})]},h.id)}):e.jsx("li",{className:"p-4 text-sm text-gray-500",children:g?"No notes with mnemonics found":"No notes found"})})]})]})}const L=q.memo(({chart:s,id:n})=>{const r=w.useRef(null),a=t=>t&&t.replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\\/g,"\\\\").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"\\n").replace(/\r/g,"\\r");return w.useEffect(()=>{F.initialize({startOnLoad:!1,theme:"default",securityLevel:"loose",fontFamily:'"trebuchet ms", verdana, arial, sans-serif',flowchart:{useMaxWidth:!0,htmlLabels:!0,curve:"linear"},pie:{useMaxWidth:!0,useMaxHeight:!0,textPosition:.75,useWidth:600,useHeight:400},sequence:{diagramMarginX:50,diagramMarginY:10,actorMargin:50,width:150,height:65,boxMargin:10,boxTextMargin:5,noteMargin:10,messageMargin:35,mirrorActors:!0,bottomMarginAdj:1,useMaxWidth:!0,rightAngles:!1,showSequenceNumbers:!1,actorFontSize:14,actorFontFamily:'"trebuchet ms", verdana, arial, sans-serif',noteFontSize:12,noteFontFamily:'"trebuchet ms", verdana, arial, sans-serif',messageFontSize:12,messageFontFamily:'"trebuchet ms", verdana, arial, sans-serif'}})},[]),w.useEffect(()=>{if(!s||!r.current)return;const t=r.current;if(t.dataset.rendering==="true")return;t.dataset.rendering="true",(async()=>{try{console.log("Rendering Mermaid chart:",s),t.innerHTML="";const d=`mermaid-${n||Math.random().toString(36).substr(2,9)}`;let o=s.trim();console.log("Applying global Chinese punctuation normalization"),o=o.replace(/“/g,'"').replace(/”/g,'"').replace(/：/g,":"),o.startsWith("pie")?(console.log("Processing pie chart"),o=o.split(`
`).map(g=>{let m=g.trim();return m.startsWith("title ")||m==="pie"||m.includes('"')&&m.includes(":")&&(m=m.replace(/^(\s*)"([^"]+)"\s*:\s*(\d+)\s*$/,'"$2": $3').replace(/^(\s*)"([^"]+)":\s*(\d+)\s*$/,'"$2": $3').replace(/^(\s*)"([^"]+)"\s*:(\d+)\s*$/,'"$2": $3').replace(/^(\s*)"([^"]+)"\s*:\s*(\d+)/,'"$2": $3')),m}).filter(g=>g.length>0).join(`
`),console.log("Processed pie chart:",o)):o.startsWith("sequenceDiagram")?(console.log("Processing sequence diagram"),o=o.split(`
`).map(m=>{let u=m.trim();return u?(u=u.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'"),u=u.replace(/\s*-\s*>\s*>\s*\+/g,"->>+").replace(/\s*-\s*>\s*>/g,"->>").replace(/\s*-\s*-\s*>\s*>/g,"-->>"),u):""}).filter(m=>m.length>0).join(`
`),console.log("Processed sequence diagram:",o)):(o=o.replace(/(\[)([^\]]*?)(\])/g,(g,m,u,b)=>m+a(u)+b),o=o.replace(/(\()([^)]*?)(\))/g,(g,m,u,b)=>m+a(u)+b),o=o.replace(/(\|)([^|]*?)(\|)/g,(g,m,u,b)=>m+a(u)+b)),(o.startsWith("graph ")||o.startsWith("flowchart "))&&!o.includes(`
`)&&(o=o.replace(/(graph\s+\w+|flowchart\s+\w+)\s+(.+)/,(g,m,u)=>{const b=u.replace(/\s+([A-Z0-9]+(?:\[[^\]]+\]|\([^)]+\))?)\s+-->/g,`
    $1 -->`).replace(/-->\s*\|([^|]+)\|\s*([A-Z0-9]+(?:\[[^\]]+\]|\([^)]+\))?)/g,"-->|$1| $2");return m+b})),console.log("Processed chart:",o);try{await F.parse(o),console.log("Mermaid parse validation successful")}catch(g){console.warn("Mermaid parse validation failed, but continuing with render:",g),o.includes("sequenceDiagram")&&(console.log("Attempting to fix sequence diagram syntax"),o=o.replace(/：/g,":").replace(/（/g,"(").replace(/）/g,")").replace(/≥/g,">=").replace(/《/g,'"').replace(/》/g,'"'),console.log("Fixed sequence diagram:",o))}const{svg:f}=await F.render(d,o);console.log("Mermaid render successful, SVG length:",f.length),t.innerHTML=f,console.log("Container after SVG insertion:",t),console.log("Container innerHTML length:",t.innerHTML.length);const l=t.querySelector("svg");l?(l.style.maxWidth="100%",l.style.height="auto",l.style.display="block",l.style.visibility="visible",o.startsWith("pie")&&(l.style.minHeight="400px",l.style.maxWidth="600px",l.style.margin="0 auto",t.style.textAlign="center",console.log("Applied pie chart specific styles")),console.log("SVG element configured successfully"),console.log("SVG dimensions:",{width:l.getAttribute("width"),height:l.getAttribute("height"),viewBox:l.getAttribute("viewBox")})):console.error("SVG element not found after insertion"),t.dataset.rendering="false"}catch(d){console.error("Mermaid rendering error:",d),console.error("Original chart content:",s),console.error("Processed chart content:",processedChart||s),t.dataset.rendering="false",t.innerHTML=`
          <div style="
            color: #d73a49; 
            background: #ffeef0; 
            border: 1px solid #fdaeb7; 
            border-radius: 6px; 
            padding: 16px; 
            margin: 10px 0;
            font-family: monospace;
          ">
            <strong>Diagram Error:</strong><br/>
            ${d.message.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}
            <details style="margin-top: 8px;">
              <summary>Show original diagram code</summary>
              <pre style="margin-top: 8px; white-space: pre-wrap;">${s.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}</pre>
            </details>
            <details style="margin-top: 8px;">
              <summary>Show processed diagram code</summary>
              <pre style="margin-top: 8px; white-space: pre-wrap;">${(processedChart||s).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}</pre>
            </details>
          </div>
        `}})()},[s,n]),e.jsx("div",{ref:r,className:"mermaid-diagram",style:{textAlign:"center",maxWidth:"100%",overflow:"auto",margin:"20px 0",minHeight:"100px"}})});function Y(){const s=`
    <code class="language-mermaid">
      <span class="hljs-selector-tag">graph</span> <span class="hljs-selector-tag">LR</span>  
      <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[可能性]</span> <span class="hljs-comment">--&gt;|最低| D[高度可能性]&lt;br&gt;（50%+）</span>
      <span class="hljs-selector-tag">A</span> <span class="hljs-comment">--&gt;|中级| E[排除合理怀疑]&lt;br&gt;（90%+）</span>
      <span class="hljs-selector-tag">A</span> <span class="hljs-comment">--&gt;|最高| F[排除一切怀疑]&lt;br&gt;（100%）</span>
    </code>
  `;console.log("=== 开始测试 Mermaid 提取 (包含<br>标签) ==="),console.log("测试HTML:",s);const a=new DOMParser().parseFromString(s,"text/html").querySelector(".language-mermaid");if(a){console.log("找到 mermaid 元素，开始提取...");const t=O(a.innerHTML);return console.log("=== 提取完成 ==="),console.log("提取的 Mermaid 代码:"),console.log(t),console.log("预期结果应该是干净的 Mermaid 语法，无 HTML 标签，<br>应转换为换行"),t}else console.log("未找到 mermaid 元素");return null}typeof window<"u"&&(window.testMermaidHelper=Y,console.log("已注册全局测试函数: window.testMermaidHelper()"));function O(s){if(console.log("=== cleanMermaidCode 开始处理 ==="),console.log("Raw Mermaid code input:",s),console.log("Raw code type:",typeof s),console.log("Raw code length:",s==null?void 0:s.length),!s||typeof s!="string")return console.log("Invalid input, returning empty string"),"";let n=s;if(s.includes("<")&&s.includes(">")){console.log("检测到HTML标签，开始去除...");let a=s.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&nbsp;/g," ").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/<br\s*\/?>/gi," ").replace(/&lt;br\s*\/?&gt;/gi," ");console.log("HTML实体处理后:",a);const t=document.createElement("div");t.innerHTML=a,n=t.textContent||t.innerText||"",console.log("HTML标签去除后:",n)}const r=n.replace(/[ \t]+/g," ").replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`).map(a=>{let t=a.trim();return t.length===0?null:(console.log("处理行:",t),(t.includes("sequenceDiagram")||t.includes("->")||t.includes("--")||t.includes("loop")||t.includes("end"))&&(t=t.replace(/\s*-\s*>\s*>\s*\+/g,"->>+").replace(/\s*-\s*>\s*>/g,"->>").replace(/\s*-\s*-\s*>\s*>/g,"-->>"),console.log("序列图语法修复后:",t)),t)}).filter(a=>a!==null&&a.length>0).join(`
`).trim();return console.log("最终清理后的 Mermaid 代码:"),console.log(r),console.log("最终代码长度:",r.length),(r.includes("<")||r.includes(">"))&&console.warn("警告：清理后的代码仍包含HTML标签:",r),console.log("=== cleanMermaidCode 处理完成 ==="),r}function J({note:s,onClick:n}){const[r,a]=w.useState(""),[t,c]=w.useState([]);w.useEffect(()=>{if(!s||!s.content){a(""),c([]);return}const b=new DOMParser().parseFromString(s.content,"text/html"),_=b.querySelectorAll(".language-mermaid, code.language-mermaid, .hyc-common-markdown__code-mermaid code"),p=[];_.forEach((i,x)=>{console.log(`Processing Mermaid element ${x}:`,i),console.log("Element className:",i.className),console.log("Element tagName:",i.tagName);let v=i.innerHTML||i.textContent||i.innerText;console.log(`Raw content for chart ${x}:`,v),!v&&i.parentElement&&(v=i.parentElement.textContent||i.parentElement.innerText,console.log(`Fallback content from parent for chart ${x}:`,v));const j=O(v);if(j&&j.trim().length>0){const N=`mermaid-chart-${x}`;p.push({id:N,code:j}),console.log(`Successfully extracted Mermaid chart ${N}:`,j);let h=i.closest(".hyc-common-markdown__code-mermaid")||i.closest(".hyc-common-markdown__code-mermaid-show-svg")||i.closest(".hyc-common-markdown__code")||i.closest("pre")||i.parentElement;if(h){const y=b.createElement("div");y.className="mermaid-placeholder",y.setAttribute("data-chart-id",N),y.style.cssText="min-height: 200px; text-align: center; padding: 20px; border: 1px solid #e1e5e9; border-radius: 6px; margin: 20px 0; background-color: #f6f8fa;",y.innerHTML=`<div style="color: #666;">Loading Mermaid diagram ${x+1}...</div>`,h.parentNode.replaceChild(y,h)}}else console.warn(`No valid Mermaid code found in element ${x}`,{element:i,rawContent:v,cleanedCode:j})}),console.log(`Found ${p.length} Mermaid charts in total`),c(i=>i.length!==p.length||i.some((v,j)=>p[j]&&(v.id!==p[j].id||v.code!==p[j].code))?p:i),a(b.body.innerHTML)},[s]);const d=()=>t.map(u=>e.jsx("div",{id:u.id,style:{margin:"20px 0"},children:e.jsx(L,{chart:u.code,id:u.id})},u.id)),o=()=>{if(!r)return e.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:r}});if(t.length===0)return e.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:r}});const _=new DOMParser().parseFromString(r,"text/html").querySelectorAll(".mermaid-placeholder"),p=[];if(_.length===0)p.push(e.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:r}},"main-content")),p.push(...d());else{let i=r;t.forEach((x,v)=>{const j=new RegExp(`<div[^>]*class="[^"]*mermaid-placeholder[^"]*"[^>]*data-chart-id="${x.id}"[^>]*>.*?</div>`,"g");if(j.test(i)){const N=i.split(j);N[0]&&p.push(e.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:N[0]}},`content-before-${v}`)),p.push(e.jsx("div",{style:{margin:"20px 0"},children:e.jsx(L,{chart:x.code,id:x.id})},x.id)),i=N.slice(1).join("")}}),i&&p.push(e.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:i}},"remaining-content"))}return p};if(!s)return e.jsx("div",{className:"text-gray-500",onClick:n,children:"Select a note to view"});const l=(()=>!s||!s.content?"reasoner":s.content.includes("hyc-component-text")?"text":(s.content.includes("hyc-component-reasoner__text"),"reasoner"))(),g=()=>e.jsx("div",{className:"yb-layout__content agent-layout__content",onClick:n,children:e.jsx("div",{className:"agent-dialogue",children:e.jsx("div",{className:"agent-dialogue__content-wrapper",children:e.jsx("div",{className:"agent-dialogue__content",children:e.jsx("div",{className:"agent-dialogue__content--common",children:e.jsx("div",{className:"agent-dialogue__content--common__content",id:"chat-content",children:e.jsx("div",{className:"agent-chat__list agent-chat__list__deepseek",children:e.jsx("div",{className:"agent-chat__list__content-wrapper",children:e.jsxs("div",{className:"agent-chat__list__content",style:{marginRight:"0px"},children:[e.jsx("div",{className:"agent-chat__list__item agent-chat__list__item--ai agent-chat__list__item--last p-0","data-conv-idx":"158","data-conv-speaker":"ai","data-conv-speech-mode":"0","data-conv-sensitive":"false",children:e.jsx("div",{className:"",children:e.jsx("div",{className:"agent-chat__speech-text--box agent-chat__speech-text--box-left",style:{width:"100%"},children:e.jsx("div",{className:"agent-chat__speech-text",children:e.jsx("div",{className:"hyc-component-text",children:o()})})})})}),e.jsx("div",{className:"agent-chat__list__placeholder"})]})})})})})})})})}),m=()=>e.jsx("div",{className:"yb-layout__content agent-layout__content",onClick:n,children:e.jsx("div",{className:"agent-dialogue",children:e.jsx("div",{className:"agent-dialogue__content-wrapper",children:e.jsx("div",{className:"agent-dialogue__content",children:e.jsx("div",{className:"agent-dialogue__content--common",children:e.jsx("div",{className:"agent-dialogue__content--common__content",id:"chat-content",children:e.jsx("div",{className:"agent-chat__list",children:e.jsx("div",{className:"agent-chat__list__content-wrapper",children:e.jsxs("div",{className:"agent-chat__list__content",style:{marginRight:"0px"},children:[e.jsx("div",{className:"agent-chat__list__item agent-chat__list__item--ai agent-chat__list__item--last p-0","data-conv-idx":"158","data-conv-speaker":"ai","data-conv-speech-mode":"0","data-conv-sensitive":"false","data-conv-id":"b5e1d739-7f95-4221-bc59-0c8cf5dda717_158",children:e.jsx("div",{className:"agent-chat__list__item__content",children:e.jsx("div",{className:"agent-chat__bubble agent-chat__bubble--ai",children:e.jsx("div",{className:"agent-chat__bubble__content",children:e.jsx("div",{className:"agent-chat__conv--ai__speech_show","data-conv-index":"79","data-speech-index":"0",children:e.jsx("div",{className:"hyc-component-reasoner",children:o()})})})})})}),e.jsx("div",{className:"agent-chat__list__placeholder"})]})})})})})})})})});return l==="text"?g():m()}function E(s){const a=new DOMParser().parseFromString(s,"text/html").querySelector("h3"),t=["法考知识点解析：","核心知识点：","总标题：","考点"],c=new RegExp(`^[\\s\\u200B\\uFEFF]*(${t.map(d=>d.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")).join("|")})`);return a&&c.test(a.textContent)&&(a.textContent=a.textContent.replace(c,"")),a?a.textContent.trim():"Untitled"}async function K(){try{const n=await fetch("/yuanbao-note-viewer/notes/index.json");if(!n.ok)throw new Error("Failed to fetch index.json");const r=await n.json(),a={root:{path:"",name:"All Notes",files:[],folders:{}}};return r.forEach(t=>{if(!t.folder||t.folder==="")a.root.files.push(t);else{const c=t.folder.split("/");let d=a.root.folders,o="";for(let f=0;f<c.length;f++){const l=c[f];o=o?`${o}/${l}`:l,d[l]||(d[l]={path:o,name:l,files:[],folders:{}}),f===c.length-1?d[l].files.push(t):d=d[l].folders}}}),a}catch(s){return console.error("Error scanning folder structure:",s),{root:{path:"",name:"All Notes",files:[],folders:{}}}}}function ee(s,n){if(!n||n===""||n==="/")return s.root||{path:"",name:"All Notes",files:[],folders:{}};const r=n.split("/").filter(t=>t!=="");let a=s.root.folders;for(let t=0;t<r.length;t++){const c=r[t];if(a[c]){if(t===r.length-1)return a[c];a=a[c].folders}else return null}return null}function te(){const{"*":s}=W(),[n,r]=w.useState([]),[a,t]=w.useState(null),[c,d]=w.useState({}),[o,f]=w.useState(null),[l,g]=w.useState(!0);w.useEffect(()=>{(async()=>{g(!0);try{const p=await K();d(p);const i=ee(p,s||"");f(i),i&&i.files?await m(i.files):(r([]),t(null))}catch(p){console.error("Error loading notes for folder:",p),r([]),t(null)}finally{g(!1)}})()},[s]);const m=async _=>{try{const i=(await Promise.all(_.map(async x=>{const N=await(await fetch(`/yuanbao-note-viewer/${x.path.replace(/^\//,"")}`)).text(),h=S(N,{allowedTags:S.defaults.allowedTags.concat(["h3","table","thead","tbody","tr","th","td","hr","ol","ul","li","blockquote","pre","code","span","svg","g","path","rect","circle","ellipse","polygon","foreignObject","marker","defs","style"]),allowedAttributes:{"*":["class","id","style"],div:["style","data-*"],pre:["class"],code:["class"],span:["class"],svg:["width","height","viewBox","xmlns","role","aria-roledescription","xmlns:xlink","xmlns:ev"],g:["id","class","transform"],path:["d","class","style","fill","stroke","stroke-width","marker-end"],rect:["x","y","width","height","class","style","fill","stroke","rx","ry"],circle:["cx","cy","r","class","style","fill","stroke"],foreignObject:["width","height"],marker:["id","class","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","orient"],table:["style"],th:["style"],td:["style"]},allowedSchemes:["http","https","data"],allowedStyles:{"*":{"font-family":[/^.*$/],"font-size":[/^.*$/],color:[/^.*$/],"line-height":[/^.*$/],padding:[/^.*$/],margin:[/^.*$/],"text-align":[/^.*$/],"font-weight":[/^.*$/],"font-style":[/^.*$/],"background-color":[/^.*$/],border:[/^.*$/],width:[/^.*$/],height:[/^.*$/],"max-width":[/^.*$/],"max-height":[/^.*$/],"white-space":[/^.*$/],"word-break":[/^.*$/],display:[/^.*$/],"box-sizing":[/^.*$/],position:[/^.*$/],top:[/^.*$/],left:[/^.*$/],right:[/^.*$/],bottom:[/^.*$/],transform:[/^.*$/],stroke:[/^.*$/],"stroke-width":[/^.*$/],"stroke-dasharray":[/^.*$/],fill:[/^.*$/],overflow:[/^.*$/]}},transformTags:{style:()=>({tagName:"",attribs:{},text:""})}}),y=E(h),$=A(x.file);return{id:x.file,title:y,content:h,createdAt:$,folder:x.folder||""}}))).sort((x,v)=>v.createdAt-x.createdAt);r(i),i.length>0?t(i[0]):t(null)}catch(p){console.error("Error loading notes:",p),r([]),t(null)}};return{notes:n,selectedNote:a,selectNote:_=>{t(_)},addNote:(_,p)=>{const i=S(p,{allowedTags:S.defaults.allowedTags.concat(["h3","table","thead","tbody","tr","th","td","hr","ol","ul","li","blockquote"]),allowedAttributes:{"*":["class"],div:["style"],table:["style"],th:["style"],td:["style"]},allowedStyles:{"*":{"font-family":[/^.*$/],"font-size":[/^.*$/],color:[/^.*$/],"line-height":[/^.*$/],padding:[/^.*$/],margin:[/^.*$/],"text-align":[/^.*$/],"font-weight":[/^.*$/],"font-style":[/^.*$/],"background-color":[/^.*$/],border:[/^.*$/],width:[/^.*$/],"white-space":[/^.*$/],"word-break":[/^.*$/],display:[/^.*$/],"box-sizing":[/^.*$/]}},transformTags:{style:()=>({tagName:"",attribs:{},text:""})}}),x=E(i),v=A(_)||Date.now(),j={id:_,title:x,content:i,createdAt:v,folder:s||""};r(N=>{const h=[j,...N].sort((y,$)=>$.createdAt-y.createdAt);return t(j),h})},folderStructure:c,currentFolder:o,isLoading:l,currentPath:s||""}}function A(s){const n=s.match(/note-(\d{14})\.html/);if(!n)return Date.now();const[r,a,t,c,d,o]=[n[1].slice(0,4),n[1].slice(4,6),n[1].slice(6,8),n[1].slice(8,10),n[1].slice(10,12),n[1].slice(12,14)],f=`${r}-${a}-${t}T${c}:${d}:${o}Z`,l=new Date(f);return new Date(l.toLocaleString("en-US",{timeZone:"Asia/Shanghai"})).getTime()}function P(){const{notes:s,selectedNote:n,selectNote:r,folderStructure:a,currentFolder:t,isLoading:c,currentPath:d}=te(),[o,f]=w.useState(!1);return c?e.jsx("div",{className:"yb-layout agent-layout layout-pc flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading notes..."})]})}):e.jsxs("div",{className:"yb-layout agent-layout layout-pc flex flex-row",children:[e.jsx(X,{notes:s,selectNote:r,selectedNote:n,isSidebarOpen:o,setIsSidebarOpen:f,folderStructure:a,currentFolder:t,currentPath:d}),e.jsx(J,{note:n,onClick:()=>f(!1)})]})}function se(){return e.jsx(B,{basename:"/yuanbao-note-viewer",children:e.jsxs(V,{children:[e.jsx(T,{path:"/",element:e.jsx(P,{})}),e.jsx(T,{path:"/*",element:e.jsx(P,{})})]})})}Q.createRoot(document.getElementById("app")).render(e.jsx(q.StrictMode,{children:e.jsx(se,{})}));
