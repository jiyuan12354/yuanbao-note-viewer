import{u as H,r as w,j as t,R as q,m as F,a as z,s as S,B,b as V,c as T,d as Q}from"./vendor-4271a838.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}})();function L(s){if(!s)return null;const a=U(s);if(a===-1)return null;const o=s.substring(a),l=D(o);return l?W(l):null}function U(s){const a=[{pattern:/<h[3-4][^>]*>[^<]*?å£è¯€[^<]*?<\/h[3-4]>/gi,priority:1,name:"h3/h4å£è¯€"},{pattern:/<strong[^>]*>[^<]*?å£è¯€[^<]*?<\/strong>/gi,priority:2,name:"strongå£è¯€"},{pattern:/<h[3-4][^>]*>[^<]*?è®°å¿†æŠ€å·§[^<]*?<\/h[3-4]>/gi,priority:3,name:"h3/h4è®°å¿†æŠ€å·§"},{pattern:/<strong[^>]*>[^<]*?è®°å¿†æŠ€å·§[^<]*?<\/strong>/gi,priority:4,name:"strongè®°å¿†æŠ€å·§"},{pattern:/<h[3-4][^>]*>[^<]*?è®°å¿†æ ¸å¿ƒè¦ä¹‰[^<]*?<\/h[3-4]>/gi,priority:5,name:"h3/h4è®°å¿†æ ¸å¿ƒè¦ä¹‰"},{pattern:/<strong[^>]*>[^<]*?è®°å¿†æ ¸å¿ƒè¦ä¹‰[^<]*?<\/strong>/gi,priority:6,name:"strongè®°å¿†æ ¸å¿ƒè¦ä¹‰"},{pattern:/<h[3-4][^>]*>[^<]*?æ ¸å¿ƒè¦ä¹‰[^<]*?<\/h[3-4]>/gi,priority:7,name:"h3/h4æ ¸å¿ƒè¦ä¹‰"},{pattern:/<strong[^>]*>[^<]*?æ ¸å¿ƒè¦ä¹‰[^<]*?<\/strong>/gi,priority:8,name:"strongæ ¸å¿ƒè¦ä¹‰"}];let o=-1,l=999,e=null;for(const{pattern:r,priority:i,name:n}of a){let f;for(;(f=r.exec(s))!==null;){const c=f.index+f[0].length,d=s.substring(c),m=Z(d);console.log(`æ‰¾åˆ° ${n} è§¦å‘è¯ï¼Œä½ç½®: ${c}, å†…å®¹: ${f[0]}, æœ‰æ•ˆå¼•å·: ${m}`),m&&i<l&&(o=c,l=i,e=n,console.log(`æ›´æ–°æœ€ä½³åŒ¹é…: ${n}, ä½ç½®: ${c}`))}r.lastIndex=0}return e&&console.log(`æœ€ç»ˆé€‰æ‹©: ${e}, ä½ç½®: ${o}`),o}function Z(s){const a=D(s);if(!a)return!1;const o=W(a),l=[/^[a-z-_]+(__[a-z-_]+)*$/i,/^[a-zA-Z0-9-_\/\.]+$/,/^\d+(\.\d+)?%?$/,/^[<>\/=\s]+$/,/^[a-zA-Z\s]+$/];for(const r of l)if(r.test(o))return!1;return/[\u4e00-\u9fa5]/.test(o)&&o.length>=4&&o.length<200}function D(s){let a=null,o=1/0;const l=[{start:34,end:34},{start:8220,end:8221},{start:12300,end:12301},{start:65294,end:65294}];for(const e of l){let r=-1;for(let i=0;i<s.length;i++)if(s.charCodeAt(i)===e.start){r=i;break}if(r!==-1){for(let i=r+1;i<s.length;i++)if(s.charCodeAt(i)===e.end){r<o&&(o=r,a=s.substring(r+1,i));break}}}return a}function W(s){if(!s)return"";let a=s.replace(/<[^>]*>/g,"");return a=a.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/[\u200B\uFEFF]/g,"").replace(/\s+/g," ").trim(),a}function G({folderStructure:s,currentPath:a,onClose:o}){const l=H(),[e,r]=w.useState(()=>{const c=new Set(["root"]);if(a){const d=a.split("/");let m="root";d.forEach(h=>{c.add(m),m=`${m}_${h}`})}return c}),i=c=>{const d=new Set(e);d.has(c)?d.delete(c):d.add(c),r(d)},n=c=>{l(!c||c===""?"/":`/${c}`),o()},f=(c,d,m=0)=>{const h=e.has(d),b=Object.keys(c.folders||{}).length>0,_=c.path===a;return t.jsxs("div",{className:"select-none",children:[t.jsxs("div",{className:`flex items-center py-1 px-2 cursor-pointer hover:bg-gray-100 rounded ${_?"bg-blue-100 text-blue-800":""}`,style:{paddingLeft:`${m*20+8}px`},onClick:()=>n(c.path),children:[b&&t.jsx("button",{className:"mr-1 p-1 hover:bg-gray-200 rounded",onClick:p=>{p.stopPropagation(),i(d)},children:t.jsx("span",{className:`inline-block transition-transform ${h?"rotate-90":""}`,children:"â–¶"})}),!b&&t.jsx("span",{className:"w-6"}),t.jsxs("span",{className:"text-sm",children:["ğŸ“ ",c.name,c.files&&c.files.length>0&&t.jsxs("span",{className:"ml-1 text-xs text-gray-500",children:["(",c.files.length,")"]})]})]}),b&&h&&t.jsx("div",{children:Object.entries(c.folders).map(([p,g])=>f(g,`${d}_${p}`,m+1))})]},d)};return!s||Object.keys(s).length===0?t.jsx("div",{className:"p-4 text-gray-500 text-sm",children:"Loading folder structure..."}):t.jsxs("div",{className:"bg-white border rounded-lg shadow-lg max-h-96 overflow-y-auto",children:[t.jsx("div",{className:"sticky top-0 bg-gray-50 px-4 py-2 border-b",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"font-medium text-gray-900",children:"Folder Navigator"}),t.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]})}),t.jsx("div",{className:"p-2",children:Object.entries(s).map(([c,d])=>f(d,c))})]})}function X({notes:s,selectNote:a,isSidebarOpen:o,selectedNote:l,setIsSidebarOpen:e,folderStructure:r,currentFolder:i,currentPath:n}){const[f,c]=w.useState(""),[d,m]=w.useState(!0),[h,b]=w.useState(!1),_=H(),p=()=>{e(!o)},g=()=>{if(!n)return;const u=n.split("/");if(u.length>1){u.pop();const y=u.join("/");_(`/${y}`)}else _("/")},x=()=>{if(!n)return t.jsxs("div",{className:"mb-2 text-xs text-gray-600 bg-gray-50 p-2 rounded",children:["ğŸ“‚ ",t.jsx("span",{className:"font-medium",children:"æ ¹ç›®å½•"})]});const u=n.split("/"),y=[];y.push(t.jsx("button",{onClick:()=>_("/"),className:"hover:text-blue-600 underline",children:"æ ¹ç›®å½•"},"root"));let $="";return u.forEach((M,k)=>{$=$?`${$}/${M}`:M;const I=k===u.length-1;if(y.push(t.jsx("span",{className:"text-gray-400 mx-1",children:"/"},`separator-${k}`)),I)y.push(t.jsx("span",{className:"font-medium text-blue-600",children:M},M));else{const O=$;y.push(t.jsx("button",{onClick:()=>_(`/${O}`),className:"hover:text-blue-600 underline",children:M},M))}}),t.jsxs("div",{className:"mb-2 text-xs text-gray-600 bg-gray-50 p-2 rounded",children:["ğŸ“‚ ",y]})},v=s.filter(u=>{const y=u.title||"Untitled",$=u.content||"",M=f.toLowerCase();return y.toLowerCase().includes(M)||$.toLowerCase().includes(M)}),j=u=>d?L(u.content):null,N=s.filter(u=>L(u.content)).length;return t.jsxs("div",{children:[t.jsx("button",{className:"fixed bottom-4 right-4 z-50 p-3 bg-blue-500 text-white rounded-full shadow-lg md:hidden",onClick:p,children:o?"Close":"Open"}),t.jsxs("div",{className:`fixed top-0 left-0 h-full w-64 bg-white shadow-lg transform transition-transform ${o?"translate-x-0 z-10":"-translate-x-full"} md:translate-x-0 md:relative md:block`,children:[t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h2",{className:"text-lg font-semibold",children:"Notes"}),t.jsxs("div",{className:"flex items-center space-x-1",children:[n&&t.jsx("button",{onClick:g,className:"p-1 hover:bg-gray-200 rounded",title:"è¿”å›ä¸Šçº§æ–‡ä»¶å¤¹",children:"â¬†ï¸"}),t.jsx("button",{onClick:()=>b(!h),className:"p-1 hover:bg-gray-200 rounded",title:"æ–‡ä»¶å¤¹å¯¼èˆª",children:"ğŸ“"})]})]}),x(),h&&t.jsx("div",{className:"absolute top-16 left-0 right-0 z-20 mx-4",children:t.jsx(G,{folderStructure:r,currentPath:n,onClose:()=>b(!1)})}),t.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["æ€»å…± ",s.length," æ¡ç¬”è®°",d&&t.jsxs("span",{children:[" | åŒ…å«å£è¯€: ",N," æ¡"]})]}),t.jsx("button",{onClick:()=>m(!d),className:`w-full mt-2 p-2 rounded-md text-sm font-medium transition-colors ${d?"bg-green-500 text-white hover:bg-green-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:d?"ğŸ§  å£è¯€æ¨¡å¼ (å¼€å¯)":"ğŸ§  å£è¯€æ¨¡å¼ (å…³é—­)"}),t.jsx("input",{type:"text",placeholder:"Search notes...",className:"w-full mt-2 p-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:f,onChange:u=>c(u.target.value)})]}),t.jsx("ul",{className:"overflow-y-auto h-[calc(100vh-200px)]",children:v.length>0?v.map(u=>{const y=j(u);return t.jsxs("li",{className:`p-4 cursor-pointer hover:bg-gray-100 ${l&&l.id===u.id?"bg-gray-200":""}`,onClick:()=>a(u),children:[t.jsx("span",{className:"text-sm",children:u.title||"Untitled"}),y&&t.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border-l-3 border-yellow-400 rounded",children:t.jsx("p",{className:"text-xs text-yellow-800 font-medium",children:y})}),t.jsx("p",{className:"text-xs text-gray-500",children:new Date(u.createdAt).toLocaleString()})]},u.id)}):t.jsx("li",{className:"p-4 text-sm text-gray-500",children:d?"No notes with mnemonics found":"No notes found"})})]})]})}function Y(s){if(console.log("Fixing mindmap syntax for:",s),!s.startsWith("mindmap"))return s;console.log("Analyzing original chart structure...");const a=s.split(`
`).map(e=>e.trim()).filter(e=>e.length>0),o=["mindmap"];for(let e=1;e<a.length;e++){const r=a[e];console.log(`Processing line ${e}: "${r}"`);let i=1,n=r;if(r.startsWith("root("))i=1;else if(r==="åè®®ç®¡è¾–"||r==="æ³•å®šç®¡è¾–(æ— åè®®æˆ–åè®®æ— æ•ˆ)")i=2;else if(r==="æœ‰æ•ˆåè®®"||r==="æ— æ•ˆåè®®"||r==="è¢«å‘Šä½æ‰€åœ°"||r==="åˆåŒå±¥è¡Œåœ°")i=3;else if(r==="å±¥è¡Œåœ°ä¹‹ç¡®å®š")i=4;else if(r==="äº‰è®®æ ‡çš„ç±»å‹"||r==="ç‰¹åˆ«è§„å®š")i=5;else if(r.startsWith(":")){if(n=r.substring(1).trim(),n.includes("æ— æ•ˆåè®®")?i=3:n.includes("ã€æœ‰æ•ˆè¦ä»¶ã€‘")?i=4:i=6,n=n.replace(/ã€([^ã€‘]+)ã€‘/g,"[$1]").replace(/<br>/g," ").replace(/â†’/g," -> "),n.length>50){const d=n.split(" ");d.length>3&&(n=d.slice(0,3).join(" ")+"...")}}else r.includes("ç»™ä»˜è´§å¸")||r.includes("äº¤ä»˜ä¸åŠ¨äº§")||r.includes("å…¶ä»–æ ‡çš„")?(i=6,n=r.replace(/^:/,"").replace(/<br>/g," ").replace(/â†’/g," -> ")):r.includes("ç½‘è´­åˆåŒ")?(i=6,n=r.replace(/^:/,"").replace(/<br>/g," ").replace(/â†’/g," -> ")):i=4;const c="  ".repeat(i)+n;o.push(c),console.log(`  -> Indent level ${i}: "${c}"`)}const l=o.join(`
`);return console.log("Fixed mindmap structure:"),console.log(l),l}const C=q.memo(({chart:s,id:a})=>{const o=w.useRef(null),l=e=>e&&e.replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\\/g,"\\\\").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"\\n").replace(/\r/g,"\\r");return w.useEffect(()=>{F.initialize({startOnLoad:!1,theme:"default",securityLevel:"loose",fontFamily:'"trebuchet ms", verdana, arial, sans-serif',flowchart:{useMaxWidth:!0,htmlLabels:!0,curve:"linear"},pie:{useMaxWidth:!0,useMaxHeight:!0,textPosition:.75,useWidth:600,useHeight:400},sequence:{diagramMarginX:50,diagramMarginY:10,actorMargin:50,width:150,height:65,boxMargin:10,boxTextMargin:5,noteMargin:10,messageMargin:35,mirrorActors:!0,bottomMarginAdj:1,useMaxWidth:!0,rightAngles:!1,showSequenceNumbers:!1,actorFontSize:14,actorFontFamily:'"trebuchet ms", verdana, arial, sans-serif',noteFontSize:12,noteFontFamily:'"trebuchet ms", verdana, arial, sans-serif',messageFontSize:12,messageFontFamily:'"trebuchet ms", verdana, arial, sans-serif'}})},[]),w.useEffect(()=>{if(!s||!o.current)return;const e=o.current;if(e.dataset.rendering==="true")return;e.dataset.rendering="true",(async()=>{try{console.log("Rendering Mermaid chart:",s),e.innerHTML="";const i=`mermaid-${a||Math.random().toString(36).substr(2,9)}`;let n=s.trim();console.log("Applying global Chinese punctuation normalization"),n=n.replace(/â€œ/g,'"').replace(/â€/g,'"').replace(/ï¼š/g,":"),n.startsWith("pie")?(console.log("Processing pie chart"),n=n.split(`
`).map(d=>{let m=d.trim();return m.startsWith("title ")||m==="pie"||m.includes('"')&&m.includes(":")&&(m=m.replace(/^(\s*)"([^"]+)"\s*:\s*(\d+)\s*$/,'"$2": $3').replace(/^(\s*)"([^"]+)":\s*(\d+)\s*$/,'"$2": $3').replace(/^(\s*)"([^"]+)"\s*:(\d+)\s*$/,'"$2": $3').replace(/^(\s*)"([^"]+)"\s*:\s*(\d+)/,'"$2": $3')),m}).filter(d=>d.length>0).join(`
`),console.log("Processed pie chart:",n)):n.startsWith("mindmap")?(console.log("Processing mindmap"),n=Y(n)):n.startsWith("sequenceDiagram")?(console.log("Processing sequence diagram"),n=n.split(`
`).map(m=>{let h=m.trim();return h?(h=h.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'"),h=h.replace(/\s*-\s*>\s*>\s*\+/g,"->>+").replace(/\s*-\s*>\s*>/g,"->>").replace(/\s*-\s*-\s*>\s*>/g,"-->>"),h):""}).filter(m=>m.length>0).join(`
`),console.log("Processed sequence diagram:",n)):(n=n.replace(/(\[)([^\]]*?)(\])/g,(d,m,h,b)=>m+l(h)+b),n=n.replace(/(\()([^)]*?)(\))/g,(d,m,h,b)=>m+l(h)+b),n=n.replace(/(\|)([^|]*?)(\|)/g,(d,m,h,b)=>m+l(h)+b)),(n.startsWith("graph ")||n.startsWith("flowchart "))&&!n.includes(`
`)&&(n=n.replace(/(graph\s+\w+|flowchart\s+\w+)\s+(.+)/,(d,m,h)=>{const b=h.replace(/\s+([A-Z0-9]+(?:\[[^\]]+\]|\([^)]+\))?)\s+-->/g,`
    $1 -->`).replace(/-->\s*\|([^|]+)\|\s*([A-Z0-9]+(?:\[[^\]]+\]|\([^)]+\))?)/g,"-->|$1| $2");return m+b})),console.log("Processed chart:",n);try{await F.parse(n),console.log("Mermaid parse validation successful")}catch(d){console.warn("Mermaid parse validation failed, but continuing with render:",d),n.includes("sequenceDiagram")&&(console.log("Attempting to fix sequence diagram syntax"),n=n.replace(/ï¼š/g,":").replace(/ï¼ˆ/g,"(").replace(/ï¼‰/g,")").replace(/â‰¥/g,">=").replace(/ã€Š/g,'"').replace(/ã€‹/g,'"'),console.log("Fixed sequence diagram:",n))}const{svg:f}=await F.render(i,n);console.log("Mermaid render successful, SVG length:",f.length),e.innerHTML=f,console.log("Container after SVG insertion:",e),console.log("Container innerHTML length:",e.innerHTML.length);const c=e.querySelector("svg");c?(c.style.maxWidth="100%",c.style.height="auto",c.style.display="block",c.style.visibility="visible",n.startsWith("pie")&&(c.style.minHeight="400px",c.style.maxWidth="600px",c.style.margin="0 auto",e.style.textAlign="center",console.log("Applied pie chart specific styles")),console.log("SVG element configured successfully"),console.log("SVG dimensions:",{width:c.getAttribute("width"),height:c.getAttribute("height"),viewBox:c.getAttribute("viewBox")})):console.error("SVG element not found after insertion"),e.dataset.rendering="false"}catch(i){console.error("Mermaid rendering error:",i),console.error("Original chart content:",s),console.error("Processed chart content:",processedChart||s),e.dataset.rendering="false";const n=processedChart||s;e.innerHTML=`
          <div style="
            color: #d73a49; 
            background: #ffeef0; 
            border: 1px solid #fdaeb7; 
            border-radius: 6px; 
            padding: 16px; 
            margin: 10px 0;
            font-family: monospace;
          ">
            <strong>Diagram Error:</strong><br/>
            ${i.message.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}
            <details style="margin-top: 8px;">
              <summary>Show original diagram code</summary>
              <pre style="margin-top: 8px; white-space: pre-wrap;">${s.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}</pre>
            </details>
            <details style="margin-top: 8px;">
              <summary>Show processed diagram code</summary>
              <pre style="margin-top: 8px; white-space: pre-wrap;">${n.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}</pre>
            </details>
          </div>
        `}})()},[s,a]),t.jsx("div",{ref:o,className:"mermaid-diagram",style:{textAlign:"center",maxWidth:"100%",overflow:"auto",margin:"20px 0",minHeight:"100px"}})});function J(){const s=`
    <code class="language-mermaid">
      <span class="hljs-selector-tag">graph</span> <span class="hljs-selector-tag">LR</span>  
      <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[å¯èƒ½æ€§]</span> <span class="hljs-comment">--&gt;|æœ€ä½| D[é«˜åº¦å¯èƒ½æ€§]&lt;br&gt;ï¼ˆ50%+ï¼‰</span>
      <span class="hljs-selector-tag">A</span> <span class="hljs-comment">--&gt;|ä¸­çº§| E[æ’é™¤åˆç†æ€€ç–‘]&lt;br&gt;ï¼ˆ90%+ï¼‰</span>
      <span class="hljs-selector-tag">A</span> <span class="hljs-comment">--&gt;|æœ€é«˜| F[æ’é™¤ä¸€åˆ‡æ€€ç–‘]&lt;br&gt;ï¼ˆ100%ï¼‰</span>
    </code>
  `;console.log("=== å¼€å§‹æµ‹è¯• Mermaid æå– (åŒ…å«<br>æ ‡ç­¾) ==="),console.log("æµ‹è¯•HTML:",s);const l=new DOMParser().parseFromString(s,"text/html").querySelector(".language-mermaid");if(l){console.log("æ‰¾åˆ° mermaid å…ƒç´ ï¼Œå¼€å§‹æå–...");const e=R(l.innerHTML);return console.log("=== æå–å®Œæˆ ==="),console.log("æå–çš„ Mermaid ä»£ç :"),console.log(e),console.log("é¢„æœŸç»“æœåº”è¯¥æ˜¯å¹²å‡€çš„ Mermaid è¯­æ³•ï¼Œæ—  HTML æ ‡ç­¾ï¼Œ<br>åº”è½¬æ¢ä¸ºæ¢è¡Œ"),e}else console.log("æœªæ‰¾åˆ° mermaid å…ƒç´ ");return null}typeof window<"u"&&(window.testMermaidHelper=J,console.log("å·²æ³¨å†Œå…¨å±€æµ‹è¯•å‡½æ•°: window.testMermaidHelper()"));function R(s){if(console.log("=== cleanMermaidCode å¼€å§‹å¤„ç† ==="),console.log("Raw Mermaid code input:",s),console.log("Raw code type:",typeof s),console.log("Raw code length:",s==null?void 0:s.length),!s||typeof s!="string")return console.log("Invalid input, returning empty string"),"";let a=s;if(s.includes("<")&&s.includes(">")){console.log("æ£€æµ‹åˆ°HTMLæ ‡ç­¾ï¼Œå¼€å§‹å»é™¤...");let l=s.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&").replace(/&nbsp;/g," ").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/<br\s*\/?>/gi," ").replace(/&lt;br\s*\/?&gt;/gi," ");console.log("HTMLå®ä½“å¤„ç†å:",l);const e=document.createElement("div");e.innerHTML=l,a=e.textContent||e.innerText||"",console.log("HTMLæ ‡ç­¾å»é™¤å:",a)}const o=a.replace(/[ \t]+/g," ").replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/<br\s*\/?>/gi,`
`).replace(/&nbsp;/g," ").split(`
`).map(l=>{let e=l.trim();return e.length===0?null:(console.log("å¤„ç†è¡Œ:",e),e.includes("[")&&e.includes("]")&&(e=e.replace(/\[([^\]]+)\]/g,(r,i)=>`[${i.replace(/\[/g,"(").replace(/\]/g,")").trim()}]`),console.log("èŠ‚ç‚¹æ ‡ç­¾æ¸…ç†å:",e)),e.includes("mindmap")||e.startsWith("root(")?console.log("Mindmapè¡Œ:",e):a.includes("mindmap")?(e=e.replace(/<br>/g," ").replace(/ã€/g,"[").replace(/ã€‘/g,"]"),console.log("Mindmapå†…å®¹æ¸…ç†å:",e)):(e.includes("sequenceDiagram")||e.includes("->")||e.includes("--")||e.includes("loop")||e.includes("end"))&&(e=e.replace(/\s*-\s*>\s*>\s*\+/g,"->>+").replace(/\s*-\s*>\s*>/g,"->>").replace(/\s*-\s*-\s*>\s*>/g,"-->>"),console.log("åºåˆ—å›¾è¯­æ³•ä¿®å¤å:",e)),e)}).filter(l=>l!==null&&l.length>0).join(`
`).trim();return console.log("æœ€ç»ˆæ¸…ç†åçš„ Mermaid ä»£ç :"),console.log(o),console.log("æœ€ç»ˆä»£ç é•¿åº¦:",o.length),(o.includes("<")||o.includes(">"))&&console.warn("è­¦å‘Šï¼šæ¸…ç†åçš„ä»£ç ä»åŒ…å«HTMLæ ‡ç­¾:",o),console.log("=== cleanMermaidCode å¤„ç†å®Œæˆ ==="),o}function K({note:s,onClick:a}){const[o,l]=w.useState(""),[e,r]=w.useState([]);w.useEffect(()=>{if(!s||!s.content){l(""),r([]);return}const b=new DOMParser().parseFromString(s.content,"text/html"),_=b.querySelectorAll(".language-mermaid, code.language-mermaid, .hyc-common-markdown__code-mermaid code"),p=[];_.forEach((g,x)=>{console.log(`Processing Mermaid element ${x}:`,g),console.log("Element className:",g.className),console.log("Element tagName:",g.tagName);let v=g.innerHTML||g.textContent||g.innerText;console.log(`Raw content for chart ${x}:`,v),!v&&g.parentElement&&(v=g.parentElement.textContent||g.parentElement.innerText,console.log(`Fallback content from parent for chart ${x}:`,v));const j=R(v);if(j&&j.trim().length>0){const N=`mermaid-chart-${x}`;p.push({id:N,code:j}),console.log(`Successfully extracted Mermaid chart ${N}:`,j);let u=g.closest(".hyc-common-markdown__code-mermaid")||g.closest(".hyc-common-markdown__code-mermaid-show-svg")||g.closest(".hyc-common-markdown__code")||g.closest("pre")||g.parentElement;if(u){const y=b.createElement("div");y.className="mermaid-placeholder",y.setAttribute("data-chart-id",N),y.style.cssText="min-height: 200px; text-align: center; padding: 20px; border: 1px solid #e1e5e9; border-radius: 6px; margin: 20px 0; background-color: #f6f8fa;",y.innerHTML=`<div style="color: #666;">Loading Mermaid diagram ${x+1}...</div>`,u.parentNode.replaceChild(y,u)}}else console.warn(`No valid Mermaid code found in element ${x}`,{element:g,rawContent:v,cleanedCode:j})}),console.log(`Found ${p.length} Mermaid charts in total`),r(g=>g.length!==p.length||g.some((v,j)=>p[j]&&(v.id!==p[j].id||v.code!==p[j].code))?p:g),l(b.body.innerHTML)},[s]);const i=()=>e.map(h=>t.jsx("div",{id:h.id,style:{margin:"20px 0"},children:t.jsx(C,{chart:h.code,id:h.id})},h.id)),n=()=>{if(!o)return t.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:o}});if(e.length===0)return t.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:o}});const _=new DOMParser().parseFromString(o,"text/html").querySelectorAll(".mermaid-placeholder"),p=[];if(_.length===0)p.push(t.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:o}},"main-content")),p.push(...i());else{let g=o;e.forEach((x,v)=>{const j=new RegExp(`<div[^>]*class="[^"]*mermaid-placeholder[^"]*"[^>]*data-chart-id="${x.id}"[^>]*>.*?</div>`,"g");if(j.test(g)){const N=g.split(j);N[0]&&p.push(t.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:N[0]}},`content-before-${v}`)),p.push(t.jsx("div",{style:{margin:"20px 0"},children:t.jsx(C,{chart:x.code,id:x.id})},x.id)),g=N.slice(1).join("")}}),g&&p.push(t.jsx("div",{className:"hyc-common-markdown hyc-common-markdown-style",dangerouslySetInnerHTML:{__html:g}},"remaining-content"))}return p};if(!s)return t.jsx("div",{className:"text-gray-500",onClick:a,children:"Select a note to view"});const c=(()=>!s||!s.content?"reasoner":s.content.includes("hyc-component-text")?"text":(s.content.includes("hyc-component-reasoner__text"),"reasoner"))(),d=()=>t.jsx("div",{className:"yb-layout__content agent-layout__content",onClick:a,children:t.jsx("div",{className:"agent-dialogue",children:t.jsx("div",{className:"agent-dialogue__content-wrapper",children:t.jsx("div",{className:"agent-dialogue__content",children:t.jsx("div",{className:"agent-dialogue__content--common",children:t.jsx("div",{className:"agent-dialogue__content--common__content",id:"chat-content",children:t.jsx("div",{className:"agent-chat__list agent-chat__list__deepseek",children:t.jsx("div",{className:"agent-chat__list__content-wrapper",children:t.jsxs("div",{className:"agent-chat__list__content",style:{marginRight:"0px"},children:[t.jsx("div",{className:"agent-chat__list__item agent-chat__list__item--ai agent-chat__list__item--last p-0","data-conv-idx":"158","data-conv-speaker":"ai","data-conv-speech-mode":"0","data-conv-sensitive":"false",children:t.jsx("div",{className:"",children:t.jsx("div",{className:"agent-chat__speech-text--box agent-chat__speech-text--box-left",style:{width:"100%"},children:t.jsx("div",{className:"agent-chat__speech-text",children:t.jsx("div",{className:"hyc-component-text",children:n()})})})})}),t.jsx("div",{className:"agent-chat__list__placeholder"})]})})})})})})})})}),m=()=>t.jsx("div",{className:"yb-layout__content agent-layout__content",onClick:a,children:t.jsx("div",{className:"agent-dialogue",children:t.jsx("div",{className:"agent-dialogue__content-wrapper",children:t.jsx("div",{className:"agent-dialogue__content",children:t.jsx("div",{className:"agent-dialogue__content--common",children:t.jsx("div",{className:"agent-dialogue__content--common__content",id:"chat-content",children:t.jsx("div",{className:"agent-chat__list",children:t.jsx("div",{className:"agent-chat__list__content-wrapper",children:t.jsxs("div",{className:"agent-chat__list__content",style:{marginRight:"0px"},children:[t.jsx("div",{className:"agent-chat__list__item agent-chat__list__item--ai agent-chat__list__item--last p-0","data-conv-idx":"158","data-conv-speaker":"ai","data-conv-speech-mode":"0","data-conv-sensitive":"false","data-conv-id":"b5e1d739-7f95-4221-bc59-0c8cf5dda717_158",children:t.jsx("div",{className:"agent-chat__list__item__content",children:t.jsx("div",{className:"agent-chat__bubble agent-chat__bubble--ai",children:t.jsx("div",{className:"agent-chat__bubble__content",children:t.jsx("div",{className:"agent-chat__conv--ai__speech_show","data-conv-index":"79","data-speech-index":"0",children:t.jsx("div",{className:"hyc-component-reasoner",children:n()})})})})})}),t.jsx("div",{className:"agent-chat__list__placeholder"})]})})})})})})})})});return c==="text"?d():m()}function A(s){const l=new DOMParser().parseFromString(s,"text/html").querySelector("h3");if(!l)return"Untitled";let e=l.textContent.trim();const r=["æ³•è€ƒçŸ¥è¯†ç‚¹è§£æï¼š","æ³•è€ƒçŸ¥è¯†ç‚¹è§£æ:","æ³•è€ƒçŸ¥è¯†ç‚¹è§£æ","æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š","æ ¸å¿ƒçŸ¥è¯†ç‚¹:","æ€»æ ‡é¢˜ï¼š","æ€»æ ‡é¢˜:","è€ƒç‚¹"];for(const i of r){const n=e.replace(/^[\s\u200B\uFEFF\u00A0]+/,"");if(n.startsWith(i)){e=n.substring(i.length).trim();break}}return e||"Untitled"}async function ee(){try{const a=await fetch("/yuanbao-note-viewer/notes/index.json");if(!a.ok)throw new Error("Failed to fetch index.json");const o=await a.json(),l={root:{path:"",name:"All Notes",files:[],folders:{}}};return o.forEach(e=>{if(!e.folder||e.folder==="")l.root.files.push(e);else{const r=e.folder.split("/");let i=l.root.folders,n="";for(let f=0;f<r.length;f++){const c=r[f];n=n?`${n}/${c}`:c,i[c]||(i[c]={path:n,name:c,files:[],folders:{}}),f===r.length-1?i[c].files.push(e):i=i[c].folders}}}),l}catch(s){return console.error("Error scanning folder structure:",s),{root:{path:"",name:"All Notes",files:[],folders:{}}}}}function te(s,a){if(!a||a===""||a==="/")return s.root||{path:"",name:"All Notes",files:[],folders:{}};const o=a.split("/").filter(e=>e!=="");let l=s.root.folders;for(let e=0;e<o.length;e++){const r=o[e];if(l[r]){if(e===o.length-1)return l[r];l=l[r].folders}else return null}return null}function se(){const{"*":s}=z(),[a,o]=w.useState([]),[l,e]=w.useState(null),[r,i]=w.useState({}),[n,f]=w.useState(null),[c,d]=w.useState(!0);w.useEffect(()=>{(async()=>{d(!0);try{const p=await ee();i(p);const g=te(p,s||"");f(g),g&&g.files?await m(g.files):(o([]),e(null))}catch(p){console.error("Error loading notes for folder:",p),o([]),e(null)}finally{d(!1)}})()},[s]);const m=async _=>{try{const g=(await Promise.all(_.map(async x=>{const N=await(await fetch(`/yuanbao-note-viewer/${x.path.replace(/^\//,"")}`)).text(),u=S(N,{allowedTags:S.defaults.allowedTags.concat(["h3","table","thead","tbody","tr","th","td","hr","ol","ul","li","blockquote","pre","code","span","svg","g","path","rect","circle","ellipse","polygon","foreignObject","marker","defs","style"]),allowedAttributes:{"*":["class","id","style"],div:["style","data-*"],pre:["class"],code:["class"],span:["class"],svg:["width","height","viewBox","xmlns","role","aria-roledescription","xmlns:xlink","xmlns:ev"],g:["id","class","transform"],path:["d","class","style","fill","stroke","stroke-width","marker-end"],rect:["x","y","width","height","class","style","fill","stroke","rx","ry"],circle:["cx","cy","r","class","style","fill","stroke"],foreignObject:["width","height"],marker:["id","class","viewBox","refX","refY","markerUnits","markerWidth","markerHeight","orient"],table:["style"],th:["style"],td:["style"]},allowedSchemes:["http","https","data"],allowedStyles:{"*":{"font-family":[/^.*$/],"font-size":[/^.*$/],color:[/^.*$/],"line-height":[/^.*$/],padding:[/^.*$/],margin:[/^.*$/],"text-align":[/^.*$/],"font-weight":[/^.*$/],"font-style":[/^.*$/],"background-color":[/^.*$/],border:[/^.*$/],width:[/^.*$/],height:[/^.*$/],"max-width":[/^.*$/],"max-height":[/^.*$/],"white-space":[/^.*$/],"word-break":[/^.*$/],display:[/^.*$/],"box-sizing":[/^.*$/],position:[/^.*$/],top:[/^.*$/],left:[/^.*$/],right:[/^.*$/],bottom:[/^.*$/],transform:[/^.*$/],stroke:[/^.*$/],"stroke-width":[/^.*$/],"stroke-dasharray":[/^.*$/],fill:[/^.*$/],overflow:[/^.*$/]}},transformTags:{style:()=>({tagName:"",attribs:{},text:""})}}),y=A(u),$=E(x.file);return{id:x.file,title:y,content:u,createdAt:$,folder:x.folder||""}}))).sort((x,v)=>v.createdAt-x.createdAt);o(g),g.length>0?e(g[0]):e(null)}catch(p){console.error("Error loading notes:",p),o([]),e(null)}};return{notes:a,selectedNote:l,selectNote:_=>{e(_)},addNote:(_,p)=>{const g=S(p,{allowedTags:S.defaults.allowedTags.concat(["h3","table","thead","tbody","tr","th","td","hr","ol","ul","li","blockquote"]),allowedAttributes:{"*":["class"],div:["style"],table:["style"],th:["style"],td:["style"]},allowedStyles:{"*":{"font-family":[/^.*$/],"font-size":[/^.*$/],color:[/^.*$/],"line-height":[/^.*$/],padding:[/^.*$/],margin:[/^.*$/],"text-align":[/^.*$/],"font-weight":[/^.*$/],"font-style":[/^.*$/],"background-color":[/^.*$/],border:[/^.*$/],width:[/^.*$/],"white-space":[/^.*$/],"word-break":[/^.*$/],display:[/^.*$/],"box-sizing":[/^.*$/]}},transformTags:{style:()=>({tagName:"",attribs:{},text:""})}}),x=A(g),v=E(_)||Date.now(),j={id:_,title:x,content:g,createdAt:v,folder:s||""};o(N=>{const u=[j,...N].sort((y,$)=>$.createdAt-y.createdAt);return e(j),u})},folderStructure:r,currentFolder:n,isLoading:c,currentPath:s||""}}function E(s){const a=s.match(/note-(\d{14})\.html/);if(!a)return Date.now();const[o,l,e,r,i,n]=[a[1].slice(0,4),a[1].slice(4,6),a[1].slice(6,8),a[1].slice(8,10),a[1].slice(10,12),a[1].slice(12,14)],f=`${o}-${l}-${e}T${r}:${i}:${n}Z`,c=new Date(f);return new Date(c.toLocaleString("en-US",{timeZone:"Asia/Shanghai"})).getTime()}function P(){const{notes:s,selectedNote:a,selectNote:o,folderStructure:l,currentFolder:e,isLoading:r,currentPath:i}=se(),[n,f]=w.useState(!1);return r?t.jsx("div",{className:"yb-layout agent-layout layout-pc flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),t.jsx("p",{className:"mt-4 text-gray-600",children:"Loading notes..."})]})}):t.jsxs("div",{className:"yb-layout agent-layout layout-pc flex flex-row",children:[t.jsx(X,{notes:s,selectNote:o,selectedNote:a,isSidebarOpen:n,setIsSidebarOpen:f,folderStructure:l,currentFolder:e,currentPath:i}),t.jsx(K,{note:a,onClick:()=>f(!1)})]})}function ne(){return t.jsx(B,{basename:"/yuanbao-note-viewer",children:t.jsxs(V,{children:[t.jsx(T,{path:"/",element:t.jsx(P,{})}),t.jsx(T,{path:"/*",element:t.jsx(P,{})})]})})}Q.createRoot(document.getElementById("app")).render(t.jsx(q.StrictMode,{children:t.jsx(ne,{})}));
